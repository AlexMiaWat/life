# Проект Life

## Краткое описание

**Life** — это экспериментальный умный компаньон с непрерывной жизнью, наблюдением и API. Проект исследует концепцию длительного существования вычислительной системы, где процесс работает постоянно, накапливая состояние и историю, которая влияет на будущее поведение.

В отличие от традиционных приложений, Life не реагирует только на внешние запросы, а существует как непрерывный процесс с внутренними циклами обновления, деградацией и необратимыми изменениями.

## Структура проекта

```
life/
├── src/
│   ├── main_server_api.py    # Основной файл с API сервером и точкой входа
│   ├── main.py                # Тестовый файл для проверки функциональности
│   ├── runtime/
│   │   └── loop.py            # Runtime-цикл с обновлением состояния и обработкой событий
│   ├── state/
│   │   └── self_state.py      # Управление состоянием и snapshots
│   ├── monitor/
│   │   └── console.py         # Мониторинг и логирование
│   ├── environment/
│   │   ├── event.py           # Структура события (Event)
│   │   ├── event_queue.py     # Очередь событий (EventQueue)
│   │   └── generator.py       # Генератор событий (EventGenerator)
│   └── meaning/
│       ├── meaning.py         # Структура интерпретации (Meaning)
│       └── engine.py           # Движок интерпретации (MeaningEngine)
├── docs/                      # Документация проекта
├── data/                      # Директория для данных (логи, snapshots)
├── .venv/                     # Виртуальное окружение Python
└── README.md                  # Этот файл
```

### Ключевые модули

- **main_server_api.py**: Основной сервер с HTTP API, управлением потоками и dev-режимом с горячим перезагрузом.
- **runtime/loop.py**: Бесконечный цикл обновления состояния с обработкой событий из Environment.
- **state/self_state.py**: Сохранение и загрузка snapshots состояния.
- **monitor/console.py**: Консольный вывод состояния и JSON-логирование в файл.
- **environment/**: Модуль среды (этап 07) - генерация и очередь событий, влияющих на Life.
- **meaning/**: Модуль интерпретации событий (этап 08) - преобразование событий в субъективное значение.

## Установка

### Требования

- Python 3.14 или выше

### Шаги установки

1. Клонируйте репозиторий:
   ```bash
   git clone <repository-url>
   cd life
   ```

2. Создайте виртуальное окружение:
   ```bash
   python -m venv .venv
   ```

3. Активируйте виртуальное окружение:
   - Windows: `.venv\Scripts\activate`
   - Linux/Mac: `source .venv/bin/activate`

4. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

   > **Примечание**: Проект использует только стандартную библиотеку Python, поэтому файл requirements.txt может быть пустым или содержать только базовые зависимости.

## Запуск

### Основной запуск

Запустите сервер с API и runtime-циклом:

```bash
python src/main_server_api.py --tick-interval 1.0 --snapshot-period 10
```

### Dev-режим

Для разработки с автоматической перезагрузкой при изменении кода:

```bash
python src/main_server_api.py --dev --tick-interval 1.0 --snapshot-period 10
```

В dev-режиме система отслеживает изменения в исходных файлах и автоматически перезагружает модули без остановки процесса.

## Конфигурация и параметры

Проект поддерживает следующие параметры командной строки:

- `--tick-interval` (float, по умолчанию 1.0): Интервал между тиками в секундах
- `--snapshot-period` (int, по умолчанию 10): Период сохранения snapshots (в тиках)
- `--clear-data` (str, по умолчанию "no"): Очистка данных при запуске ("yes" для очистки)
- `--dev`: Включение режима разработки с автоматической перезагрузкой

Примеры:

```bash
# Быстрый цикл с частыми snapshots
python src/main_server_api.py --tick-interval 0.5 --snapshot-period 5

# Очистка данных при старте
python src/main_server_api.py --clear-data yes
```

## API

Сервер предоставляет HTTP API на `http://localhost:8000`.

### Endpoints

#### GET /status

Возвращает текущее состояние системы в формате JSON.

**Пример запроса:**
```bash
curl http://localhost:8000/status
```

**Пример ответа:**
```json
{
  "alive": true,
  "ticks": 150,
  "age": 150.2,
  "energy": 85.0,
  "stability": 0.95,
  "integrity": 0.98
}
```

#### GET /clear-data

Очищает все логи и snapshots. Полезно для сброса состояния системы.

**Пример запроса:**
```bash
curl http://localhost:8000/clear-data
```

**Ответ:** "Data cleared"

#### POST /event

Добавляет событие в очередь Environment.

**Тело запроса (JSON):**
```json
{
  "type": "noise",
  "intensity": 0.1,
  "timestamp": 1700000.0,
  "metadata": {"source": "manual"}
}
```

`intensity`, `timestamp`, `metadata` — опциональны. Если `timestamp` не передан, используется текущее время.

**Пример запроса:**
```bash
curl -X POST http://localhost:8000/event \
  -H "Content-Type: application/json" \
  -d '{"type":"shock","intensity":-0.5}'
```

**Ответ:** "Event accepted"

## Мониторинг

### Консольный вывод

Система выводит состояние в реальном времени в консоль в формате:
```
• [ticks] age=X.Xs energy=X.X int=X.XX stab=X.XX
```

### Snapshots

Каждые `snapshot-period` тиков состояние сохраняется в JSON-файл в директории `data/snapshots/`. Файлы именуются как `snapshot_XXXXXX.json`, где XXXXXX - номер тика.

### Логирование

Все тики логируются в `data/tick_log.jsonl` в формате JSON Lines. Каждый тик - отдельная строка с полным состоянием.

## Особенности

### Горячая очистка данных

- Очистка логов и snapshots возможна как через API (`/clear-data`), так и параметром `--clear-data yes` при запуске
- Позволяет сбросить состояние без перезапуска процесса

### Надежный перезапуск API

- В dev-режиме API сервер автоматически перезапускается при изменении кода
- Runtime-цикл продолжает работать без прерываний

### Обработка ошибок

- Исключения в runtime-цикле уменьшают integrity системы
- Ошибки логируются с полным traceback
- Система продолжает работу даже при сбоях в отдельных компонентах

### Состояние системы

Life отслеживает следующие параметры состояния:

- **alive**: Флаг жизни (завершается при energy/integrity/stability <= 0)
- **ticks**: Количество прошедших тиков
- **age**: Время жизни в секундах
- **energy**: Энергия (изменяется под влиянием событий среды)
- **stability**: Стабильность (изменяется под влиянием событий среды)
- **integrity**: Целостность (уменьшается при ошибках и событиях типа shock)

Эти параметры создают динамику, где прошлое влияет на будущее, делая систему "живой" в экспериментальном смысле.

### Environment (Среда) - Этап 07

Life существует в среде, которая генерирует события:

- **Типы событий**: `noise` (случайные воздействия), `decay` (естественный износ), `recovery` (восстановление), `shock` (резкие воздействия), `idle` (отсутствие событий)
- **Интенсивность**: Каждый тип события имеет свой диапазон интенсивности, влияющий на степень воздействия
- **Обработка**: События обрабатываются на каждом тике, изменяя состояние Life через функцию интерпретации
- **Асинхронность**: События генерируются в фоновом потоке независимо от основного цикла

Среда не знает о внутренностях Life - она только порождает события, а Life сама интерпретирует их значение.

### Генерация событий

Два способа создавать события:

1. **Через API** (ручное добавление):
   ```bash
   curl -X POST http://localhost:8000/event \
     -H "Content-Type: application/json" \
     -d '{"type":"noise","intensity":0.1}'
   ```

2. **Отдельный генератор в другом терминале** (периодическая отправка на API):
   ```bash
   python -m environment.generator_cli --interval 5 --host localhost --port 8000
   ```
   Интервал можно менять параметром `--interval` (секунды).