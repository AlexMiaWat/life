# Проект Life

## Краткое описание

**Life** — это экспериментальный умный компаньон с непрерывной жизнью, наблюдением и API. Проект исследует концепцию длительного существования вычислительной системы, где процесс работает постоянно, накапливая состояние и историю, которая влияет на будущее поведение.

В отличие от традиционных приложений, Life не реагирует только на внешние запросы, а существует как непрерывный процесс с внутренними циклами обновления, деградацией и необратимыми изменениями.

## Структура проекта

```
life/
├── src/
│   ├── main_server_api.py    # Основной файл с API сервером и точкой входа
│   ├── main.py                # Тестовый файл для проверки функциональности
│   ├── runtime/
│   │   └── loop.py            # Runtime-цикл с обновлением состояния
│   ├── state/
│   │   └── self_state.py      # Управление состоянием и snapshots
│   └── monitor/
│       └── console.py         # Мониторинг и логирование
├── docs/                      # Документация проекта
├── data/                      # Директория для данных (логи, snapshots)
├── .venv/                     # Виртуальное окружение Python
└── README.md                  # Этот файл
```

### Ключевые модули

- **main_server_api.py**: Основной сервер с HTTP API, управлением потоками и dev-режимом с горячим перезагрузом.
- **runtime/loop.py**: Бесконечный цикл обновления состояния с заданным интервалом тиков.
- **state/self_state.py**: Сохранение и загрузка snapshots состояния.
- **monitor/console.py**: Консольный вывод состояния и JSON-логирование в файл.

## Установка

### Требования

- Python 3.14 или выше

### Шаги установки

1. Клонируйте репозиторий:
   ```bash
   git clone <repository-url>
   cd life
   ```

2. Создайте виртуальное окружение:
   ```bash
   python -m venv .venv
   ```

3. Активируйте виртуальное окружение:
   - Windows: `.venv\Scripts\activate`
   - Linux/Mac: `source .venv/bin/activate`

4. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

   > **Примечание**: Проект использует только стандартную библиотеку Python, поэтому файл requirements.txt может быть пустым или содержать только базовые зависимости.

## Запуск

### Основной запуск

Запустите сервер с API и runtime-циклом:

```bash
python src/main_server_api.py --tick-interval 1.0 --snapshot-period 10
```

### Dev-режим

Для разработки с автоматической перезагрузкой при изменении кода:

```bash
python src/main_server_api.py --dev --tick-interval 1.0 --snapshot-period 10
```

В dev-режиме система отслеживает изменения в исходных файлах и автоматически перезагружает модули без остановки процесса.

## Конфигурация и параметры

Проект поддерживает следующие параметры командной строки:

- `--tick-interval` (float, по умолчанию 1.0): Интервал между тиками в секундах
- `--snapshot-period` (int, по умолчанию 10): Период сохранения snapshots (в тиках)
- `--clear-data` (str, по умолчанию "no"): Очистка данных при запуске ("yes" для очистки)
- `--dev`: Включение режима разработки с автоматической перезагрузкой

Примеры:

```bash
# Быстрый цикл с частыми snapshots
python src/main_server_api.py --tick-interval 0.5 --snapshot-period 5

# Очистка данных при старте
python src/main_server_api.py --clear-data yes
```

## API

Сервер предоставляет HTTP API на `http://localhost:8000`.

### Endpoints

#### GET /status

Возвращает текущее состояние системы в формате JSON.

**Пример запроса:**
```bash
curl http://localhost:8000/status
```

**Пример ответа:**
```json
{
  "alive": true,
  "ticks": 150,
  "age": 150.2,
  "energy": 85.0,
  "stability": 0.95,
  "integrity": 0.98
}
```

#### GET /clear-data

Очищает все логи и snapshots. Полезно для сброса состояния системы.

**Пример запроса:**
```bash
curl http://localhost:8000/clear-data
```

**Ответ:** "Data cleared"

## Мониторинг

### Консольный вывод

Система выводит состояние в реальном времени в консоль в формате:
```
• [ticks] age=X.Xs energy=X.X int=X.XX stab=X.XX
```

### Snapshots

Каждые `snapshot-period` тиков состояние сохраняется в JSON-файл в директории `data/snapshots/`. Файлы именуются как `snapshot_XXXXXX.json`, где XXXXXX - номер тика.

### Логирование

Все тики логируются в `data/tick_log.jsonl` в формате JSON Lines. Каждый тик - отдельная строка с полным состоянием.

## Особенности

### Горячая очистка данных

- Очистка логов и snapshots возможна как через API (`/clear-data`), так и параметром `--clear-data yes` при запуске
- Позволяет сбросить состояние без перезапуска процесса

### Надежный перезапуск API

- В dev-режиме API сервер автоматически перезапускается при изменении кода
- Runtime-цикл продолжает работать без прерываний

### Обработка ошибок

- Исключения в runtime-цикле уменьшают integrity системы
- Ошибки логируются с полным traceback
- Система продолжает работу даже при сбоях в отдельных компонентах

### Состояние системы

Life отслеживает следующие параметры состояния:

- **alive**: Флаг жизни (завершается при energy/integrity/stability <= 0)
- **ticks**: Количество прошедших тиков
- **age**: Время жизни в секундах
- **energy**: Энергия (уменьшается со временем)
- **stability**: Стабильность (уменьшается со временем)
- **integrity**: Целостность (уменьшается при ошибках)

Эти параметры создают динамику, где прошлое влияет на будущее, делая систему "живой" в экспериментальном смысле.