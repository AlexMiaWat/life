# TODO: Развитие проекта (Генерация 20260120_094041)

> **Создано:** 20260120
> **Сессия:** 20260120_094041

## Высокий приоритет

- [ ] MCP engine v2 для `life-docs`: многословный поиск, индекс, ранжирование, контекст
  - [ ] Реализовать `search_mode` (AND/OR/PHRASE) для `search_docs`/`search_todo` (из плана `mcp_engine_redesign_ab76d85d`)
  - [ ] Вынести индексатор в отдельный модуль (например `mcp_index_engine.py`) и сделать кэш (content_cache + inverted index)
  - [ ] Добавить умное ранжирование по структуре `docs/` (core/system/concepts/meta/test/archive) и статусу документа
  - [ ] Добавить обновление/перестроение индекса отдельной MCP-командой (чтобы агент мог “refresh index” перед поиском)
  - [ ] Спроектировать и реализовать fallback стратегию без LLM (и опционально — multi-provider для LLM, если появится)

- [ ] Разгрузить `src/runtime/loop.py`: выделить менеджеры и убрать “скрытые” расходы
  - [ ] Вынести сохранение snapshot в `SnapshotManager` (политика периодичности, ошибки, формат)
  - [ ] Вынести логирование/буферизацию в `LogManager` (и перестать вызывать `_flush_log_buffer()` на каждом тике)
  - [ ] Вынести политику “weakness/penalties” в `LifePolicy` (единые пороги, конфиг, тестируемость)
  - [ ] Убрать `print()` из hot-path runtime (заменить на `logger` + уровни, выключаемые по умолчанию)
  - [ ] Добавить unit-тесты на корректность делегирования и отсутствие регрессий поведения

- [ ] Субъективное время (Subjective Time) как “сквозная ось” жизни
  - [ ] Добавить в `SelfState` поля субъективного времени (например `subjective_age`/`subjective_time`) и коэффициенты модуляции
  - [ ] Интегрировать вычисление субъективного времени в runtime loop (учесть energy/stability + интенсивность последних событий)
  - [ ] Протянуть субъективный timestamp в `MemoryEntry` и привязать воспоминания к субъективному времени (из планов “Философия времени”)
  - [ ] Обновить мониторинг (`src/monitor/console.py`) чтобы показывать physical vs subjective time
  - [ ] Добавить тесты: монотонность subjective time, диапазоны, влияние интенсивности/стабильности

- [ ] Потокобезопасность и консистентность “state” между API и runtime
  - [ ] Ввести “immutable snapshot для API”: API читает только сериализованный snapshot состояния, а не живой объект
  - [ ] Определить контракт: что именно возвращает `/status` (только безопасные поля, без transient/внутренних)
  - [ ] Добавить синхронизацию доступа (lock/RW-lock) или модель “один писатель — много читателей” через атомарную замену snapshot
  - [ ] Добавить тесты на гонки чтения `/status` во время тиков (и edge cases очереди событий)

## Средний приоритет

- [ ] Dev-mode без “горячего” `importlib.reload`: безопасный перезапуск процесса/компонентов
  - [ ] Зафиксировать проблемы текущего подхода (идентичность объектов, висящие потоки/серверы, непредсказуемость)
  - [ ] Спроектировать dev-mode как перезапуск процесса (например через внешний watcher) или строгое “stop → start” внутри одного процесса
  - [ ] Убрать/ограничить диагностические `print`-блоки в `src/main_server_api.py` (оставить управляемый логгер)
  - [ ] Добавить smoke-тест на dev-mode (старт → изменение → рестарт → сохранение/восстановление snapshot)

- [ ] Наблюдаемость (observability): метрики, события, трассировка причинно-следственных цепочек
  - [ ] Ввести структурированные логи (JSONL) для ключевых стадий: event → meaning → decision → action → feedback
  - [ ] Добавить метрики runtime: длительность тика, размер очереди, количество событий/тик, latency feedback
  - [ ] Документировать “операционную модель” (где логи, как читать, как искать деградации)

- [ ] Производительность: профилирование hot-path и регрессионные бенчмарки
  - [ ] Добавить profiling-профиль для runtime loop (включаемый флагом) и собрать baseline
  - [ ] Оптимизировать самые частые операции (копирование словарей параметров, сериализация snapshot, работа с memory)
  - [ ] Добавить бенчмарки (pytest marker `performance`) и пороги/алерты на регрессии

- [ ] Документация и ADR как “единый источник истины”
  - [ ] Добавить/обновить ADR для: Subjective Time, State snapshot for API, Runtime Loop managers, MCP index architecture
  - [ ] Провести ревизию docs на соответствие коду (особенно runtime-loop, api-server, memory, meaning-engine)
  - [ ] Добавить “how to extend” гайд: как правильно добавить новый модуль/слой без нарушения философии проекта

## Низкий приоритет

- [ ] Экспериментальные “ритмы и эхо” (после стабилизации основы)
  - [ ] Добавить внутренние ритмы (например `circadian_phase`) и описать влияние на восстановление/стабильность
  - [ ] Добавить “memory echoes” (спонтанные всплывания) как внутренние события с записью в историю
  - [ ] Добавить тесты-инварианты, чтобы эксперименты не ломали базовые ограничения (нет целей/оптимизации)
