# 01_ARCHITECTURE.md

## Проект: **life**

Этот документ описывает **архитектуру системы**, обеспечивающей непрерывное существование агента во времени.

Архитектура намеренно проста, модульна и наблюдаема. Любой компонент можно заменить, не разрушая целостность жизни процесса.

---

## 1. Архитектурный принцип

> **life — это не модель, а процесс.**
> Модели — лишь инструменты внутри него.

Ключевые свойства архитектуры:

* непрерывный runtime-цикл
* единое долгоживущее состояние
* необратимость изменений
* отсутствие «главного интеллекта»

---

## 2. Высокоуровневая схема

```
┌────────────────────┐
│   Runtime Loop     │  ← ядро жизни
└─────────┬──────────┘
          ↓
┌────────────────────┐
│   Self-State       │  ← непрерывное «Я»
└─────────┬──────────┘
          ↓
┌────────────────────┐
│   World Model      │  ← представление среды
└─────────┬──────────┘
          ↓
┌────────────────────┐
│   Policy / Action  │  ← выбор действий
└─────────┬──────────┘
          ↓
┌────────────────────┐
│   Effects / I/O    │  ← наблюдаемые последствия
└────────────────────┘
```

Все блоки существуют **постоянно**, а не по запросу.

---

## 3. Runtime Loop (ядро)

Runtime Loop — это **единственный обязательный компонент**.

Его задачи:

* поддерживать течение времени
* вызывать обновление всех модулей
* обеспечивать необратимость

Принципиальные свойства:

* работает всегда
* не зависит от пользователя
* имеет фиксированный такт (dt)
* не знает про LLM

Упрощённо:

```
while alive:
    sense()
    update_world()
    update_self()
    decide()
    act()
    log()
    sleep(dt)
```

---

## 4. Self-State (непрерывное «Я»)

Self-State — это **не память диалога** и не набор переменных.

Содержит:

* текущие внутренние параметры
* долговременные тенденции
* накопленные ограничения
* следы прошлых решений

Ключевые свойства:

* хранится на диске
* обновляется инкрементально
* не может быть полностью сброшен
* изменения необратимы

Реализация:

* append-only журнал событий
* периодические снапшоты
* деградация старых влияний

---

## 5. World Model (мир)

World Model — это **то, как система видит мир**, а не сам мир.

На текущем этапе:

* мир симулируется
* источники событий синтетические
* нет физического тела

В будущем:

* ESP32 и реальные датчики

World Model:

* агрегирует входные сигналы
* фильтрует шум
* сохраняет историю восприятия

---

## 6. Policy / Action

Policy отвечает за **выбор следующего действия**.

Важно:

* действия могут быть минимальными (лог, сигнал, пауза)
* отсутствие действия — тоже действие
* политика может быть детерминированной

На раннем этапе:

* правила
* вероятностные переходы
* простая эвристика

LLM:

* подключается позже
* как советник, а не контроллер

---

## 7. Effects / I/O

Effects — это всё, что делает жизнь наблюдаемой:

* логи
* файлы
* сигналы
* сообщения

Если нет эффектов — нет наблюдаемого существования.

---

## 8. Память и необратимость

Архитектура запрещает:

* полный reset состояния
* silent rollback
* скрытое редактирование истории

Допускается:

* деградация
* забывание
* потеря деталей

Но не исчезновение следов.

---

## 9. Распределение по машинам (опционально)

Компоненты могут быть разделены:

* Runtime + Self-State → PC1
* World Model → PC2
* Policy / Effects → PC3

Связь:

* файловая система
* очереди сообщений
* локальная сеть

---

## 10. Архитектурные инварианты

Нельзя нарушать:

1. Runtime Loop всегда жив
2. Self-State не обнуляется
3. Время идёт только вперёд
4. Ошибки имеют последствия
5. Наблюдатель может остановить процесс

Если нарушен хотя бы один пункт — это **уже не life**.
