# Задача #2: Расширение модели событий - Социальные и экзистенциальные типы

**Идентификатор:** task_2_20260120_212346

**Дата создания:** 2026-01-21

**Приоритет:** Высокий

**Статус:** Планирование

## Техническое описание задачи

### Цель
Расширить модель событий системы Life новыми типами событий, представляющими социальные взаимодействия и экзистенциальные переживания. Новые события должны составлять 14.3% от общего потока событий и обладать системой зависимостей между собой.

### Текущая ситуация
В системе уже реализованы базовые типы событий (noise, decay, recovery, shock, idle, memory_echo) и социальные/когнитивные типы (social_presence, social_conflict, social_harmony, cognitive_doubt, cognitive_clarity, cognitive_confusion, existential_void, existential_purpose, existential_finitude).

**Проблемы текущей реализации:**
1. Новые события (connection, isolation, insight, confusion, curiosity, meaning_found, void, acceptance) имеют очень низкие веса (0.01 каждый)
2. Отсутствует система зависимостей между событиями
3. Интенсивности не адаптируются к контексту жизни

### Требования к реализации

#### 1. Новые типы событий
Добавить 8 новых типов событий с соответствующими характеристиками:

| Тип события | Диапазон интенсивности | Предполагаемое воздействие |
|-------------|------------------------|---------------------------|
| `connection` | [0.0, 0.8] | Положительное: +energy, +stability, +integrity |
| `isolation` | [-0.7, 0.0] | Отрицательное: -energy, -stability, -integrity |
| `insight` | [0.0, 0.6] | Положительное: +energy, +stability, +integrity |
| `confusion` | [-0.5, 0.0] | Отрицательное: -energy, -stability, -integrity |
| `curiosity` | [-0.3, 0.4] | Смешанное: может быть как положительным, так и отрицательным |
| `meaning_found` | [0.0, 0.9] | Сильно положительное: ++energy, ++stability, ++integrity |
| `void` | [-0.8, 0.0] | Сильно отрицательное: --energy, --stability, --integrity |
| `acceptance` | [0.0, 0.5] | Положительное: +energy, +stability, +integrity |

#### 2. Корректировка вероятностного распределения
Увеличить веса новых событий до достижения 14.3% от общего потока:

**Текущие веса (нуждаются в корректировке):**
- Все новые события: 0.01 (слишком мало)

**Целевые веса:**
- connection: 0.028
- isolation: 0.025
- insight: 0.022
- confusion: 0.020
- curiosity: 0.018
- meaning_found: 0.015
- void: 0.012
- acceptance: 0.010

#### 3. Система зависимостей между событиями
Реализовать механизм цепочек и паттернов событий:

**Типы зависимостей:**
- **Последовательные цепочки:** событие A повышает вероятность события B
- **Взаимоисключающие пары:** события, которые не могут следовать друг за другом
- **Усиливающие паттерны:** комбинации событий, усиливающие эффект
- **Компенсаторные паттерны:** события, компенсирующие предыдущие

**Примеры цепочек:**
- `confusion` → `insight` (поиск понимания после замешательства)
- `isolation` → `connection` (попытка восстановить связь после изоляции)
- `void` → `meaning_found` (поиск смысла после переживания пустоты)
- `curiosity` → `confusion` (любопытство может привести к замешательству)

#### 4. Адаптивные интенсивности
Интенсивности событий должны адаптироваться на основе:
- Текущего состояния Life (energy, stability, integrity)
- История предыдущих событий
- Время жизни и опыт

## Архитектурные решения и обоснование

### Архитектурные принципы
Задача должна соответствовать принципам проекта Life:

1. **Непрерывность существования:** Новые события не должны нарушать стабильность системы
2. **Отсутствие магии:** Все механизмы должны быть явными и понятными
3. **Медленное изменение:** Весовые коэффициенты должны изменяться постепенно
4. **Локальная автономность:** Каждый компонент работает независимо

### Выбранная архитектура

#### 1. EventGenerator с адаптивными весами
```python
class AdaptiveEventGenerator(EventGenerator):
    def __init__(self):
        super().__init__()
        self.event_history = []
        self.dependency_matrix = self._build_dependency_matrix()

    def _build_dependency_matrix(self) -> Dict[str, Dict[str, float]]:
        # Матрица переходных вероятностей между событиями
        return {
            "confusion": {"insight": 1.5, "curiosity": 0.8},
            "isolation": {"connection": 1.3, "void": 0.9},
            # ... остальные зависимости
        }

    def generate(self) -> Event:
        # Учитывать историю и зависимости при выборе типа события
        weights = self._calculate_adaptive_weights()
        event_type = random.choices(self.types, weights=weights)[0]

        # Адаптировать интенсивность на основе контекста
        intensity = self._calculate_adaptive_intensity(event_type)

        return Event(type=event_type, intensity=intensity, timestamp=time.time())
```

#### 2. EventDependencyManager
Отдельный компонент для управления зависимостями:

```python
class EventDependencyManager:
    def __init__(self):
        self.chain_patterns = self._load_chain_patterns()
        self.exclusion_rules = self._load_exclusion_rules()

    def get_dependency_modifier(self, previous_events: List[Event], candidate_type: str) -> float:
        # Рассчитать модификатор вероятности на основе предыдущих событий
        modifier = 1.0

        for pattern in self.chain_patterns:
            if self._matches_pattern(previous_events, pattern):
                if candidate_type in pattern["triggers"]:
                    modifier *= pattern["boost"]

        return modifier
```

#### 3. Интеграция с MeaningEngine
Обновить MeaningEngine для учета новых весов значимости:

```python
# Новые веса в type_weight
type_weight.update({
    "connection": 1.1,
    "isolation": 1.0,
    "insight": 1.2,
    "confusion": 0.8,
    "curiosity": 0.7,
    "meaning_found": 1.4,
    "void": 1.3,
    "acceptance": 0.9,
})
```

### Обоснование решений

#### Почему именно эти типы событий?
- **Социальные (connection, isolation):** Отражают фундаментальную потребность в связях с другими
- **Когнитивные (insight, confusion, curiosity):** Представляют процесс познания и понимания
- **Экзистенциальные (meaning_found, void, acceptance):** Захватывают глубокие переживания о смысле жизни

#### Почему 14.3% от потока?
- Достаточно для заметного влияния на поведение
- Не доминирует над базовыми событиями (noise, decay, recovery)
- Позволяет системе эволюционировать без потери стабильности

#### Почему система зависимостей?
- Создает более реалистичную модель психологических процессов
- Позволяет событиям "резонировать" друг с другом
- Добавляет глубину и предсказуемость поведению Life

## План реализации

### Этап 1: Корректировка весов (1-2 дня)
1. Обновить веса в EventGenerator для достижения 14.3%
2. Провести тестирование распределения
3. Убедиться, что система остается стабильной

### Этап 2: Система зависимостей (3-4 дня)
1. Создать EventDependencyManager
2. Реализовать базовые цепочки событий
3. Интегрировать с EventGenerator
4. Добавить механизмы исключения конфликтующих событий

### Этап 3: Адаптивные интенсивности (2-3 дня)
1. Реализовать контекстную адаптацию интенсивностей
2. Интегрировать с состоянием Life
3. Добавить историческую адаптацию

### Этап 4: Тестирование и оптимизация (2-3 дня)
1. Обновить существующие тесты
2. Добавить тесты для новых зависимостей
3. Провести нагрузочное тестирование
4. Оптимизировать производительность

### Этап 5: Документация и интеграция (1-2 дня)
1. Обновить техническую документацию
2. Создать примеры использования
3. Интегрировать с системой мониторинга

## Потенциальные риски и их митигация

### Риск 1: Нарушение стабильности системы
**Описание:** Новые события с высокими весами могут привести к нестабильному поведению

**Митигация:**
- Постепенное увеличение весов в несколько итераций
- Автоматическое снижение весов при обнаружении нестабильности
- Обширное тестирование перед развертыванием

### Риск 2: Слишком сложная система зависимостей
**Описание:** Сложные цепочки могут сделать поведение непредсказуемым

**Митигация:**
- Начать с простых биграммных зависимостей
- Ограничить максимальную длину цепочек (не более 3 событий)
- Добавить механизмы "забывания" старых зависимостей

### Риск 3: Производительность
**Описание:** Расчет зависимостей может замедлить генерацию событий

**Митигация:**
- Кэширование результатов расчетов
- Предварительная подготовка матриц переходов
- Асинхронная обработка зависимостей

### Риск 4: Несоответствие архитектуре
**Описание:** Новые компоненты могут нарушить принципы локальной автономности

**Митигация:**
- Регулярные проверки соответствия ADR
- Код-ревью с фокусом на архитектурные принципы
- Модульное тестирование компонентов

## Критерии приемки

### Функциональные критерии
- [ ] Новые типы событий генерируются с правильными весами (14.3% от потока)
- [ ] Система зависимостей работает корректно
- [ ] Интенсивности адаптируются к контексту
- [ ] Все новые события обрабатываются MeaningEngine
- [ ] Система остается стабильной при длительной работе

### Нефункциональные критерии
- [ ] Производительность генерации событий не ухудшилась >5%
- [ ] Память не утекает при длительной работе
- [ ] Код соответствует стандартам проекта
- [ ] Документация обновлена и актуальна

### Тестовые критерии
- [ ] Все существующие тесты проходят
- [ ] Новые тесты для зависимостей реализованы
- [ ] Нагрузочное тестирование пройдено
- [ ] Интеграционные тесты с полным жизненным циклом

## Связь с другими задачами и компонентами проекта

### Зависимости от других задач
- **Задача 1 (Архитектурная эволюция):** Использует субъективное время для адаптации интенсивностей
- **Задача 3 (Улучшение тестирования):** Требует новых тестов для проверки зависимостей
- **Задача 4 (Оптимизация производительности):** Может быть затронута изменениями в генераторе

### Влияние на компоненты
- **Environment:** Новые типы событий в EventGenerator
- **MeaningEngine:** Обновленные веса значимости и паттерны обработки
- **Runtime Loop:** Потенциально измененная частота событий
- **Memory:** Новые паттерны для индексации и поиска
- **State:** Влияние на stability и integrity через новые события

### Синергия с будущими задачами
- **Социальные взаимодействия:** Основа для будущей системы multi-Life взаимодействий
- **Философский анализ:** Новые события обеспечат богатый материал для анализа
- **Адаптация:** Данные о зависимостях помогут в обучении адаптивного поведения

---

**Следующие шаги:**
1. Начать с этапа 1 (корректировка весов)
2. Регулярно оценивать стабильность системы
3. Документировать все изменения и их влияние