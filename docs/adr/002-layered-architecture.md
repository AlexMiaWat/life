# ADR 002: Многослойная архитектура

## Статус
✅ Принято

## Дата
2026-01-15

## Контекст
Необходимо организовать компоненты системы Life таким образом, чтобы обеспечить:
- Четкое разделение ответственности
- Минимальные связи между компонентами
- Возможность независимого развития каждого слоя
- Соблюдение принципа "без активного управления"

## Решение
Принять многослойную архитектуру с четко определенными ролями каждого слоя:

### Слои системы

1. **Runtime Loop** — главный цикл жизни
   - Управляет последовательностью операций
   - Координирует взаимодействие слоев
   - Отвечает за жизненный цикл системы

2. **Environment** — внешняя среда
   - Генерация и обработка событий
   - Интерфейс с внешним миром
   - Предоставление "стимулов" системе

3. **Meaning Engine** — интерпретация
   - Оценка значимости событий
   - Расчет потенциального воздействия
   - Определение паттернов реакции

4. **Memory** — память
   - Хранение значимых событий
   - Активация релевантных воспоминаний
   - Забывание и архивация

5. **Decision** — принятие решений
   - Выбор паттерна реакции
   - Минимальная логика выбора
   - Fallback на Meaning Engine

6. **Action** — выполнение действий
   - Внутренние эффекты на состояние
   - Запись действий в память
   - Минимальные изменения

7. **Feedback** — обратная связь
   - Регистрация действий
   - Наблюдение последствий
   - Запись результатов

8. **Learning** — обучение
   - Анализ статистики
   - Медленное изменение параметров
   - Без оценки эффективности

9. **Adaptation** — адаптация
   - Следование за Learning
   - Медленная перестройка поведения
   - Без собственной логики

10. **Planning & Intelligence** — фиксация и обработка
    - Нейтральное хранение последовательностей
    - Обработка доступной информации
    - Без интерпретации

### Принципы взаимодействия
- Каждый слой знает только о соседних слоях
- Данные передаются только "вниз" по слоям
- Обратная связь идет через отдельные механизмы
- Runtime Loop координирует все взаимодействия

## Обоснование

### За
- **Четкое разделение**: каждый слой имеет определенную ответственность
- **Минимальные связи**: упрощает тестирование и модификацию
- **Гибкость**: можно заменять реализации слоев
- **Понимаемость**: легко объяснить назначение каждого компонента

### Против
- **Сложность координации**: Runtime Loop становится сложным
- **Потенциальные узкие места**: все данные проходят через центральный цикл
- **Жесткие ограничения**: трудно добавить "поперечные" взаимодействия

## Последствия

### Положительные
- Архитектура соответствует философии проекта
- Легко добавлять новые слои
- Прозрачные границы ответственности
- Удобное тестирование отдельных компонентов

### Отрицательные
- Runtime Loop становится "бутылочным горлышком"
- Сложно реализовать асинхронные взаимодействия
- Ограничения на прямые связи между слоями

### Риски
- **Производительность**: все операции в одном потоке
- **Сложность**: координация большого числа слоев
- **Жесткость**: трудно изменить границы слоев

## Связанные документы
- [docs/architecture/overview.md](../architecture/overview.md) — архитектура системы
- [docs/architecture/sequence-diagrams.md](../architecture/sequence-diagrams.md) — диаграммы потоков