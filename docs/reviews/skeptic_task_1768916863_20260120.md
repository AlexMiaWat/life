# –°–∫–µ–ø—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–≤—å—é –∑–∞–¥–∞—á–∏ task_1768916863

> **–î–∞—Ç–∞:** 2026-01-20  
> **–ó–∞–¥–∞—á–∞:** –í—ã–Ω–µ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ snapshot –≤ `SnapshotManager`  
> **–†–æ–ª—å:** –°–∫–µ–ø—Ç–∏–∫  
> **–°—Ç–∞—Ç—É—Å:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑

---

## üîç –û–±–∑–æ—Ä

–ó–∞–¥–∞—á–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –≤—ã–Ω–æ—Å –ª–æ–≥–∏–∫–∏ —Å–Ω–∞–ø—à–æ—Ç–æ–≤ –∏–∑ `src/runtime/loop.py` –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π `SnapshotManager`. –ê–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –Ω–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–µ–¥–æ—Ä–∞–±–æ—Ç–∫–∏** –∏ **–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**.

---

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ SnapshotManager**: –ö–ª–∞—Å—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫.
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ loop.py**: SnapshotManager –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ runtime loop.
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Unit-—Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: ADR 005 –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω—ã.

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ flush –ª–æ–≥–∏–∫–∏ –≤ `save_snapshot()`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í —Ñ—É–Ω–∫—Ü–∏–∏ `save_snapshot()` (—Å—Ç—Ä–æ–∫–∞ 978 –≤ `src/state/self_state.py`) –µ—Å—Ç—å –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ `state._flush_log_buffer()`:

```python
def save_snapshot(state: SelfState, compress: bool = False):
    # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –±—É—Ñ–µ—Ä –ª–æ–≥–æ–≤ –ø–µ—Ä–µ–¥ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
    state._flush_log_buffer()  # <-- –ü–†–û–ë–õ–ï–ú–ê
```

**–ö–æ–Ω—Ñ–ª–∏–∫—Ç:** –í `src/runtime/loop.py` (—Å—Ç—Ä–æ–∫–∏ 560, 567) flush —É–∂–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `LogManager`:

```python
log_manager.maybe_flush(self_state, phase="before_snapshot")
snapshot_was_made = snapshot_manager.maybe_snapshot(self_state)
if snapshot_was_made:
    log_manager.maybe_flush(self_state, phase="after_snapshot")
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- **–î–≤–æ–π–Ω–æ–π flush**: –õ–æ–≥–∏ –º–æ–≥—É—Ç —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å—Å—è –¥–≤–∞–∂–¥—ã (—á–µ—Ä–µ–∑ LogManager –∏ –≤–Ω—É—Ç—Ä–∏ save_snapshot)
- **–ù–∞—Ä—É—à–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: `save_snapshot()` –Ω–µ –¥–æ–ª–∂–Ω–∞ —É–ø—Ä–∞–≤–ª—è—Ç—å flush –ª–æ–≥–∏–∫–æ–π
- **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: –õ–∏—à–Ω–∏–π I/O –≤ hot-path

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–±—Ä–∞—Ç—å `state._flush_log_buffer()` –∏–∑ `save_snapshot()`. Flush –¥–æ–ª–∂–µ–Ω —É–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ `LogManager` –≤ runtime loop.

---

### 2. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `compress` –≤ `save_snapshot()`

**–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏—è `save_snapshot()` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `compress: bool = False`, –Ω–æ –æ–Ω **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** –≤ –∫–æ–¥–µ:

```python
def save_snapshot(state: SelfState, compress: bool = False):
    # ... –∫–æ–¥ ...
    # compress –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- **–õ–æ–∂–Ω–æ–µ –æ–±–µ—â–∞–Ω–∏–µ**: –°–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–µ—â–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç
- **–ü—É—Ç–∞–Ω–∏—Ü–∞**: –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–≥—É—Ç –æ–∂–∏–¥–∞—Ç—å —Å–∂–∞—Ç–∏–µ, –Ω–æ –µ–≥–æ –Ω–µ –±—É–¥–µ—Ç
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥**: –õ–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∂–∞—Ç–∏–µ, –ª–∏–±–æ —É–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** 
- –í–∞—Ä–∏–∞–Ω—Ç 1: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∂–∞—Ç–∏–µ —á–µ—Ä–µ–∑ gzip (–∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
- –í–∞—Ä–∏–∞–Ω—Ç 2: –£–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `compress` –∏–∑ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã

---

### 3. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç—á–µ—Ç–∞ –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –í —Ñ–∞–π–ª–µ `docs/results/test_task_1768916863.md` –æ–ø–∏—Å–∞–Ω –æ—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ **Learning Engine, Adaptation Manager –∏ Meaning Engine**, –Ω–æ –∑–∞–¥–∞—á–∞ –±—ã–ª–∞ –æ **SnapshotManager**.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- **–ü—É—Ç–∞–Ω–∏—Ü–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: –ù–µ–ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫–æ–π –æ—Ç—á–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –∫–∞–∫–æ–π –∑–∞–¥–∞—á–µ
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Ç—á–µ—Ç–∞**: –ù–µ—Ç —è–≤–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–º–µ–Ω–Ω–æ SnapshotManager
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –±—ã–ª–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ SnapshotManager –∏–ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –æ—Ç—á–µ—Ç.

---

### 4. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π `ticks > 0` –≤ `should_snapshot()`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –º–µ—Ç–æ–¥–µ `should_snapshot()` –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ `ticks > 0`:

```python
def should_snapshot(self, ticks: int) -> bool:
    return ticks > 0 and ticks % self.period_ticks == 0
```

**–í–æ–ø—Ä–æ—Å:** –ï—Å–ª–∏ —Ç–∏–∫–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 0, —Ç–æ –Ω–∞ —Ç–∏–∫–µ 0 —Å–Ω–∞–ø—à–æ—Ç –Ω–µ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞–º–µ—Ä–µ–Ω–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º (–Ω–µ –¥–µ–ª–∞—Ç—å —Å–Ω–∞–ø—à–æ—Ç –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏), –Ω–æ —ç—Ç–æ **–Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ**.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- **–ù–µ—è—Å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**: –ù–µ–ø–æ–Ω—è—Ç–Ω–æ, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –±–∞–≥–æ–º –∏–ª–∏ —Ñ–∏—á–µ–π
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: –ù–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, –ø–æ—á–µ–º—É —Ç–∏–∫ 0 –∏—Å–∫–ª—é—á–µ–Ω

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –õ–∏–±–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –ª–∏–±–æ —É–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `ticks > 0`, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ –Ω—É–∂–Ω–∞.

---

## ‚ö†Ô∏è –°–†–ï–î–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 5. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ None –¥–ª—è `self_state` –≤ `maybe_snapshot()`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥ `maybe_snapshot()` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ `self_state` –Ω–µ —Ä–∞–≤–µ–Ω `None`:

```python
def maybe_snapshot(self, self_state: SelfState) -> bool:
    if self.should_snapshot(self_state.ticks):  # <-- –ú–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å, –µ—Å–ª–∏ self_state is None
        try:
            self.saver(self_state)
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- **–ù–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –æ—à–∏–±–∫–∞**: –ï—Å–ª–∏ `self_state` —Ä–∞–≤–µ–Ω `None`, –æ—à–∏–±–∫–∞ –±—É–¥–µ—Ç –Ω–µ—è—Å–Ω–æ–π
- **–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ fail-fast**: –õ—É—á—à–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —è–≤–Ω–æ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `if self_state is None: raise ValueError("self_state cannot be None")` –≤ –Ω–∞—á–∞–ª–µ –º–µ—Ç–æ–¥–∞.

---

### 6. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –∫–æ–¥–∞ –≤ `save_snapshot()`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ `plan_result_task_1768916863.md` (—Å—Ç—Ä–æ–∫–∞ 61) —Å–∫–∞–∑–∞–Ω–æ:

> `SnapshotManager`: "–∫–æ–≥–¥–∞" –¥–µ–ª–∞—Ç—å —Å–Ω–∞–ø—à–æ—Ç –∏ "–∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏"  
> `save_snapshot()`: "–∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å" (—Ñ–æ—Ä–º–∞—Ç, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è, –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É)

–ù–æ `save_snapshot()` —Ç–∞–∫–∂–µ –¥–µ–ª–∞–µ—Ç flush –ª–æ–≥–æ–≤, —á—Ç–æ **–Ω–µ —è–≤–ª—è–µ—Ç—Å—è** —á–∞—Å—Ç—å—é "–∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å".

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- **–ù–∞—Ä—É—à–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: `save_snapshot()` –¥–µ–ª–∞–µ—Ç –±–æ–ª—å—à–µ, —á–µ–º –¥–æ–ª–∂–Ω–∞
- **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: –†–µ–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—é

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–±—Ä–∞—Ç—å flush –∏–∑ `save_snapshot()` –∏ –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.

---

### 7. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ runtime loop

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è `SnapshotManager`, –Ω–æ –Ω–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã SnapshotManager –≤ —Ä–µ–∞–ª—å–Ω–æ–º runtime loop
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–π –ø–æ–≤–µ–¥–µ–Ω–∏—è (—Å–Ω–∞–ø—à–æ—Ç—ã –¥–µ–ª–∞—é—Ç—Å—è —Å —Ç–æ–π –∂–µ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å—é)
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –º–µ–∂–¥—É LogManager –∏ SnapshotManager

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- **–†–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–π**: –ú–æ–≥—É—Ç –±—ã—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **–ù–µ–ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: –¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ä–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–π runtime loop –∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–æ–≤.

---

## ‚ö†Ô∏è –ú–ï–õ–ö–ò–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### 8. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –í —Ä–∞–∑–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã:
- "snapshot" vs "—Å–Ω–∞–ø—à–æ—Ç"
- "SnapshotManager" vs "–º–µ–Ω–µ–¥–∂–µ—Ä —Å–Ω–∞–ø—à–æ—Ç–æ–≤"

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã –≤ –∫–æ–¥–µ –∏ —Ä—É—Å—Å–∫–∏–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏).

---

### 9. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ `docs/components/runtime-loop.md` –µ—Å—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `LogManager` –∏ `LifePolicy`, –Ω–æ –Ω–µ—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è `SnapshotManager`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `SnapshotManager` –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.

---

### 10. –ù–µ—è—Å–Ω–æ—Å—Ç—å –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `maybe_snapshot()` –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Å–Ω–∞–ø—à–æ—Ç—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –æ—à–∏–±–æ–∫ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `learning_errors` –∏ `adaptation_errors` –≤ runtime loop) –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å–æ —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏.

---

## üìä –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–ª–∞–Ω—É

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ:

1. ‚úÖ –°–æ–∑–¥–∞–Ω `SnapshotManager` —Å –º–µ—Ç–æ–¥–∞–º–∏ `should_snapshot()` –∏ `maybe_snapshot()`
2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `run_loop()` –≤–º–µ—Å—Ç–æ inline-–ª–æ–≥–∏–∫–∏
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã unit-—Ç–µ—Å—Ç—ã
4. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### ‚ùå –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é:

1. ‚ö†Ô∏è **–ü–æ–ª–∏—Ç–∏–∫–∞ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç–∏**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –Ω–æ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π `ticks > 0`
2. ‚ö†Ô∏è **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –Ω–æ –Ω–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
3. ‚ö†Ô∏è **–§–æ—Ä–º–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è**: –û—Å—Ç–∞–µ—Ç—Å—è –≤ `save_snapshot()`, –Ω–æ —Ç–∞–º –µ—Å—Ç—å –ª–∏—à–Ω–∏–π flush

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

### –ö—Ä–∏—Ç–∏—á–Ω–æ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):

1. **–£–±—Ä–∞—Ç—å `_flush_log_buffer()` –∏–∑ `save_snapshot()`** ‚Äî –Ω–∞—Ä—É—à–∞–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏** ‚Äî –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –∏ –∑–∞–¥–∞—á–∏
3. **–†–µ—à–∏—Ç—å –≤–æ–ø—Ä–æ—Å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `compress`** ‚Äî –ª–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å, –ª–∏–±–æ —É–±—Ä–∞—Ç—å

### –í–∞–∂–Ω–æ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è):

4. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ runtime loop
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ `ticks > 0`** –≤ `should_snapshot()`
6. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ None** –¥–ª—è `self_state` –≤ `maybe_snapshot()`

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å):

7. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
8. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è —Å–Ω–∞–ø—à–æ—Ç–æ–≤
9. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## üî¨ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

1. **–ü–æ—á–µ–º—É `save_snapshot()` –¥–µ–ª–∞–µ—Ç flush –ª–æ–≥–æ–≤?** –≠—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏. Flush –¥–æ–ª–∂–µ–Ω —É–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ `LogManager`.

2. **–ó–∞—á–µ–º –Ω—É–∂–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `compress`?** –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –∑–∞—á–µ–º –æ–Ω–∞ –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ?

3. **–ü–æ—á–µ–º—É —Ç–∏–∫ 0 –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ —Å–Ω–∞–ø—à–æ—Ç–æ–≤?** –≠—Ç–æ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∏–ª–∏ –±–∞–≥?

4. **–ü–æ—á–µ–º—É –Ω–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤?** Unit-—Ç–µ—Å—Ç—ã —Ö–æ—Ä–æ—à–∏, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é.

5. **–ö–∞–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –ø—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏?** –ï—Å–ª–∏ —Å–Ω–∞–ø—à–æ—Ç—ã –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è, –∫–∞–∫ —ç—Ç–æ –±—É–¥–µ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ?

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**, –Ω–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–µ–¥–æ—Ä–∞–±–æ—Ç–∫–∏**, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:
- –ù–∞—Ä—É—à–µ–Ω–∏—é —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é –ª–æ–≥–∏–∫–∏ flush
- –ü—É—Ç–∞–Ω–∏—Ü–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –ø—Ä–æ–±–ª–µ–º–∞–º –≤ production

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –∑–∞–¥–∞—á–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (—É–±—Ä–∞—Ç—å flush –∏–∑ `save_snapshot()`, –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç)
2. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
3. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

---

**–û—Ç—á–µ—Ç –≥–æ—Ç–æ–≤!**
