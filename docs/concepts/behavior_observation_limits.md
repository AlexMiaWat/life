# Правила активного наблюдения за поведением системы Life

**Дата:** 2026-01-22 (обновлено согласно ADR 001 - активная архитектура)
**Цель:** Определить допустимые границы активного логирования в рамках архитектуры Life
**Принцип:** Активное структурированное логирование ключевых этапов без интерпретации данных
**Архитектурное решение:** [ADR 001](decisions/adr_001_passive_observation_boundaries.md)

---

## Архитектурные ограничения

### Активное логирование vs интерпретация данных

#### Разрешенные паттерны (активное логирование):
- ✅ Структурированное логирование фактов обработки
- ✅ Корреляция между этапами (event → meaning → decision → action → feedback)
- ✅ Сбор сырых данных без анализа
- ✅ Временные метки и счетчики

#### Запрещенные паттерны анализа

**❌ Интерпретация данных:**
- Нельзя оценивать "хорошее" или "плохое" поведение
- Нельзя интерпретировать причины изменений
- Нельзя делать выводы о "самоосознании" или "адаптивности"

**❌ Термины, подразумевающие сознание:**
- Самоосознание (self-awareness)
- Этическое поведение (ethical behavior)
- Адаптивность (adaptability)
- Интеллект (intelligence в смысле мышления)
- Обучение (learning в смысле понимания)

**❌ Анализ трендов:**
- Нельзя анализировать "развитие" системы
- Нельзя оценивать "прогресс" или "регресс"
- Нельзя делать прогнозы поведения

**❌ Обратная связь:**
- Наблюдение не влияет на работу системы
- Данные не используются для корректировки поведения
- Отсутствие циклов обратной связи

---

## Допустимые данные для сбора

### SelfState параметры (пассивный мониторинг)
```python
{
    "energy": float,        # Текущий уровень энергии
    "stability": float,     # Уровень стабильности
    "integrity": float,     # Целостность системы
    "fatigue": float,       # Уровень усталости
    "tension": float,       # Уровень напряжения
    "age": float,           # Время жизни (субъективное)
    "subjective_time": float, # Субъективное время
    "memory_size": int,     # Размер памяти (число записей)
    "recent_events_count": int, # Количество недавних событий
    "action_count": int,    # Счетчик действий
    "decision_count": int,  # Счетчик решений
    "feedback_count": int,  # Счетчик обратной связи
    "learning_params_count": int, # Количество параметров обучения
    "adaptation_params_count": int, # Количество параметров адаптации
    "ticks": int            # Общее количество тиков
}
```

### Статистика компонентов (количественные данные)
```python
{
    "component_name": {
        "count": int,           # Количество экземпляров
        "active": int,          # Активные компоненты
        "inactive": int,        # Неактивные компоненты
        "total_size": int,      # Общий размер в байтах
        "average_lifetime": float # Среднее время жизни
    }
}
```

### История изменений (временные ряды)
```python
{
    "timestamp": int,       # Метка времени (тик)
    "component": str,       # Имя компонента
    "action": str,          # Действие (create/update/delete)
    "old_value": any,       # Предыдущее значение
    "new_value": any        # Новое значение
}
```

---

## Правила сбора данных

### 1. Пассивность
- Наблюдение не влияет на работу системы
- Отсутствие дополнительных вычислений для анализа
- Минимальное потребление ресурсов

### 2. Полнота
- Сбор всех доступных SelfState параметров
- Мониторинг всех активных компонентов
- Фиксация всех изменений состояния

### 3. Структурированность
- Данные сохраняются в предопределенных форматах
- Единообразие именования полей
- Четкая типизация данных

### 4. Доступность
- Данные доступны для внешнего экспорта
- Поддержка стандартных форматов (JSON, CSV)
- Возможность выборки по времени/компонентам

### 5. Опциональность
- Система полностью опциональна
- Отсутствие влияния на работу Life при отключении
- Возможность запуска в отдельном процессе

---

## Интеграция в систему

### Полная внешняя интеграция (ADR 001)
- **Система полностью вынесена из runtime loop**
- **Отсутствие параметров управления в runtime:** Удалены `enable_passive_observation` и `observation_collection_interval`
- **Асинхронный сбор:** Отдельный поток/процесс без влияния на производительность Life

### Хуки сбора данных
- Сбор данных происходит внешними инструментами
- Чтение существующих snapshot файлов без доступа к runtime
- Graceful degradation при отсутствии данных

### Формат хранения
- Временные ряды в памяти для быстрого доступа
- Периодический экспорт на диск
- Ротация файлов для предотвращения переполнения

---

## Использование данных

### Внешний анализ
- Данные предназначены для анализа внешними инструментами
- Возможность построения графиков и диаграмм
- Сравнение различных запусков системы

### Отладка и мониторинг
- Помощь в выявлении проблем производительности
- Мониторинг роста сложности системы
- Отслеживание паттернов использования ресурсов

---

## Реализация

### Компоненты системы наблюдения

1. **StateTracker** - сбор параметров SelfState
2. **ComponentMonitor** - мониторинг компонентов
3. **DataCollector** - агрегация и хранение данных
4. **HistoryManager** - управление временными рядами
5. **ObservationExporter** - экспорт данных в JSON/CSV форматы

### Интеграция
- Хуки в runtime loop для периодического сбора
- Экспорт данных по запросу или автоматически
- Минимальное API для внешнего доступа

---

## Тестирование

### Критерии валидности
- Корректность сбора всех SelfState параметров
- Полнота данных о компонентах
- Отсутствие влияния на производительность
- Правильность экспорта в различные форматы

---

## Критические архитектурные запреты

### ❌ Абсолютно запрещено (нарушает ADR 001)

1. **Любая интерпретация данных**
   - Расчет rate/frequency/event_processing_rate
   - Анализ трендов или прогнозирование
   - Оценка "хорошего" или "плохого" поведения

2. **Влияние на runtime Life**
   - Синхронные вызовы в runtime loop
   - Дополнительные вычисления для анализа
   - Параметры управления в runtime функциях

3. **Обратная связь**
   - Данные не влияют на поведение системы
   - Отсутствие циклов обратной связи
   - Нет рекомендаций или советов системе

4. **Интерфейсы интерпретации**
   - API endpoints с анализом или оценками
   - Поля recommendations в ответах
   - Термины оценки поведения

### ⚠️ Риски при нарушении

- **Архитектурный дрейф:** Система постепенно вернется к анализу
- **Производительность:** Влияние на ticks/sec системы Life
- **Надежность:** Дополнительные точки отказа
- **Сложность:** Увеличение технического долга

---

*Этот документ определяет границы допустимого наблюдения и предотвращает архитектурные нарушения.*