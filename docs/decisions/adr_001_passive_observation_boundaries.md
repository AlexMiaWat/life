# ADR 001: Определение границ пассивного наблюдения в системе Life

**Дата:** 2026-01-22
**Статус:** Принято
**Контекст:** После кризис-восстановления observability (task_1769025371) выявлены архитектурные нарушения концепции "пассивного наблюдения"

---

## Проблема

Текущая реализация системы observability позиционируется как "пассивное наблюдение", но содержит фундаментальные архитектурные нарушения:

1. **Активный сбор данных**: Сбор каждые 300 тиков ≠ пассивность
2. **Влияние на производительность**: Синхронная интеграция в runtime loop
3. **Архитектурные нарушения**: Интерпретация данных вместо сырых счетчиков
4. **Отсутствие границ**: Не определено, что допустимо в пассивном наблюдении

## Требования к пассивному наблюдению

### 1. Истинная пассивность
- **Запрещено**: Активный сбор данных в runtime loop
- **Запрещено**: Влияние на производительность системы Life
- **Запрещено**: Любые дополнительные вычисления для анализа

### 2. Только сырые данные
- **Разрешено**: Сбор только raw counters без расчетов
- **Разрешено**: Чтение существующих логов и снимков
- **Запрещено**: Расчет rate/frequency/event_processing_rate

### 3. Внешняя интеграция
- **Разрешено**: Асинхронный сбор из внешних источников
- **Разрешено**: Отдельный поток/процесс
- **Запрещено**: Синхронные вызовы в runtime loop

## Решение

### Архитектурные границы

#### Допустимые компоненты пассивного наблюдения:

1. **RawDataCollector** - сбор только сырых счетчиков
   - cycle_count: int
   - uptime_seconds: float
   - memory_entries_count: int
   - error_count: int
   - action_count: int
   - event_count: int
   - state_change_count: int

2. **AsyncPassiveObserver** - асинхронный наблюдатель
   - Отдельный поток выполнения
   - Чтение внешних snapshot файлов
   - Отсутствие доступа к runtime объектам

3. **ObservationExporter** - экспорт данных для анализа
   - Только экспорт в JSON/CSV
   - Без интерпретации данных
   - Внешний инструмент анализа

#### Запрещенные паттерны:

1. **Любые расчетные поля**: rate, frequency, averages
2. **Интерпретация поведения**: анализ трендов, прогнозирование
3. **Влияние на runtime**: синхронные вызовы, дополнительные вычисления
4. **Обратная связь**: данные не влияют на поведение Life

### Интеграция в runtime

#### Текущая проблема:
```python
# runtime/loop.py:245
enable_passive_observation=False,  # По умолчанию отключено - почему?
observation_collection_interval=300,  # Каждые 300 тиков - активно!
```

#### Решение:
- Полностью убрать интеграцию из runtime loop
- Сделать систему полностью внешней
- Убрать параметры `enable_passive_observation` и `observation_collection_interval`

### Тестирование границ

#### Архитектурные тесты:
- Тест на отсутствие влияния на ticks/sec
- Тест на отсутствие доступа к runtime объектам
- Тест на только raw данные (без расчетов)

#### Функциональные тесты:
- Тест экспорта данных
- Тест асинхронного сбора
- Тест graceful degradation при ошибках

## Последствия

### Положительные:
- Четкие архитектурные границы
- Истинная пассивность наблюдения
- Отсутствие влияния на производительность
- Упрощенная архитектура

### Отрицательные:
- Менее "богатые" данные для анализа
- Требуется внешний анализ данных
- Ограниченная полезность для разработки

### Риски:
- Система может оказаться невостребованной
- Потеря ценности для debugging
- Переосмысление необходимости observability

## Альтернативы

### Альтернатива 1: Полное удаление observability
- **Плюсы**: Упрощение архитектуры, отсутствие технического долга
- **Минусы**: Потеря возможности анализа поведения системы

### Альтернатива 2: Активное наблюдение с ограничениями
- **Плюсы**: Богатые данные для анализа
- **Минусы**: Архитектурные нарушения, влияние на производительность

### Альтернатива 3: Статус-кво
- **Плюсы**: Существующая реализация
- **Минусы**: Архитектурные нарушения, технический долг

## Решение: Принята альтернатива "Истинная пассивность"

Выбрана истинная пассивность с четкими границами. Если система не нужна в таком виде - будет удалена полностью.

---

## Реализация

### Фаза 1: Архитектурная чистка (Критично)
1. Удалить все расчетные поля из SystemMetrics
2. Убрать поле `recommendations` из API
3. Удалить интеграцию из runtime loop
4. Сделать сбор полностью асинхронным

### Фаза 2: Документация (Важно)
1. Создать `docs/components/observability.md`
2. Обновить `docs/concepts/behavior_observation_limits.md`
3. Добавить архитектурные тесты

### Фаза 3: Оптимизация (Желательно)
1. Добавить graceful error handling
2. Оптимизировать производительность
3. Добавить monitoring использования

---

*Этот ADR определяет границы пассивного наблюдения и предотвращает будущие архитектурные нарушения.*