# План внедрения статического анализа кода (mypy, pylint, black)

## Задача: T.12 - Добавить статический анализ кода (mypy, pylint, black)

**Дата создания:** 2026-01-21
**Статус:** В работе

## Анализ текущего состояния

### ✅ Уже внедрено:
- **Black** - автоматическое форматирование кода (настроено в pre-commit и CI)
- **Ruff** - современная альтернатива pylint (линтер + автофиксы, настроен в pre-commit и CI)
- **isort** - сортировка импортов (настроен в pre-commit и CI)
- **pytest-cov** - анализ покрытия тестами

### ⚠️ Отсутствует:
- **MyPy** - статическая проверка типов
- Конфигурационные файлы для статического анализа
- Полная типизация codebase

## План внедрения

### Этап 1: Анализ codebase и настройка инфраструктуры
- [x] Проанализировать уровень типизации в существующих модулях
- [ ] Создать `pyproject.toml` с конфигурацией для всех инструментов
- [ ] Настроить MyPy в "постепенном режиме" (без строгой типизации)
- [ ] Проверить и донастроить конфигурацию Black/Ruff

### Этап 2: Внедрение MyPy
- [ ] Добавить MyPy в pre-commit hooks
- [ ] Интегрировать MyPy в CI/CD пайплайн
- [ ] Настроить игнорирование файлов без типизации на начальном этапе
- [ ] Создать план постепенного добавления type hints

### Этап 3: Исправление выявленных проблем
- [ ] Запустить полный анализ на текущем коде
- [ ] Исправить критические проблемы типизации
- [ ] Добавить базовые type hints для основных функций/классов
- [ ] Обновить документацию с примерами типизации

### Этап 4: Интеграция и автоматизация
- [ ] Обновить CI/CD для строгой проверки статического анализа
- [ ] Создать скрипты для локального запуска всех инструментов
- [ ] Обновить документацию разработчика
- [ ] Провести тестирование на реальном коде

## Технические детали

### Конфигурация MyPy:
- Использовать `--ignore-missing-imports` для постепенного внедрения
- Настроить `mypy.ini` или секцию в `pyproject.toml`
- Начать с проверки только основных модулей

### Конфигурация Ruff:
- Убедиться, что покрывает основные правила качества кода
- Дополнить конфигурацию специфичными правилами для проекта

### Конфигурация Black:
- Проверить текущие настройки форматирования
- Убедиться в совместимости с isort

## Ожидаемые результаты

1. **Автоматическая проверка качества кода** при каждом коммите
2. **Единообразное форматирование** всего кода
3. **Выявление потенциальных ошибок** на этапе статического анализа
4. **Постепенное повышение качества типизации** codebase
5. **Улучшение поддерживаемости** и читаемости кода

## Риски и mitigation

- **Большое количество ошибок на старте**: Использовать постепенный режим внедрения
- **Сопротивление команды**: Показать преимущества на примерах
- **Замедление CI/CD**: Оптимизировать конфигурацию инструментов

## Следующие шаги

1. Создать `pyproject.toml` с базовой конфигурацией
2. Запустить MyPy на тестовом режиме
3. Исправить основные проблемы
4. Интегрировать в CI/CD