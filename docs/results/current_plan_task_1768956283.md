# План выполнения задачи: Обновить MeaningEngine с новыми весами значимости

## Цель задачи
Реализовать адаптивные веса значимости для типов событий в MeaningEngine, которые изменяются на основе опыта системы (learning_params.event_type_sensitivity), вместо статических весов.

## Текущий статус реализации
✅ **MeaningEngine реализован и интегрирован** (v1.0)
- Статические веса значимости для типов событий (type_weight в appraisal)
- Статические базовые воздействия (base_impacts в impact_model)
- Интеграция с learning_params для модификации чувствительности

## Анализ текущей реализации

### Существующие веса значимости (type_weight)
```python
type_weight = {
    "shock": 1.5,          # Шоки всегда значимы
    "noise": 0.5,          # Шум часто игнорируется
    "recovery": 1.0,       # Восстановление нормально
    "decay": 1.0,          # Распад нормален
    "idle": 0.2,           # Бездействие почти не значимо
    "memory_echo": 0.8,    # Внутренние воспоминания умеренно значимы
    # Новые социальные события
    "social_presence": 0.9,  # Присутствие других умеренно значимо
    "social_conflict": 1.2,  # Конфликт вызывает стресс
    "social_harmony": 1.1,   # Гармония значима позитивно
    # Новые когнитивные события
    "cognitive_doubt": 0.8,  # Сомнение умеренно значимо
    "cognitive_clarity": 1.0,# Ясность нормально значима
    "cognitive_confusion": 0.7,# Путаница менее значима чем шок
    # Новые экзистенциальные события
    "existential_void": 1.3,  # Пустота очень значима
    "existential_purpose": 1.4,# Цель крайне значима
    "existential_finitude": 1.1,# Конечность значима
    # Новые социально-эмоциональные события
    "connection": 1.1,      # Связь с другими значима
    "isolation": 1.0,       # Изоляция значима
    # Новые когнитивные события
    "insight": 1.2,         # Озарение очень значимо
    "confusion": 0.8,       # Замешательство умеренно значимо
    "curiosity": 0.7,       # Любопытство мало значимо
    # Новые экзистенциальные события
    "meaning_found": 1.4,   # Нахождение смысла крайне значимо
    "void": 1.3,            # Пустота очень значима
    "acceptance": 0.9,      # Принятие умеренно значимо
}
```

### Существующие базовые воздействия (base_impacts)
```python
base_impacts = {
    "shock": {"energy": -1.5, "stability": -0.10, "integrity": -0.05},
    "noise": {"energy": -0.3, "stability": -0.02, "integrity": 0.0},
    "recovery": {"energy": +1.0, "stability": +0.05, "integrity": +0.02},
    # ... остальные типы
}
```

## План реализации адаптивных весов

### Этап 1: Анализ и проектирование (1-2 дня)
1. **Изучить механизм learning_params.event_type_sensitivity**
   - Как формируются значения чувствительности
   - Диапазон значений [0.0, 1.0]
   - Принцип медленного изменения

2. **Спроектировать систему адаптивных весов**
   - Формула модификации весов на основе чувствительности
   - Ограничения для предотвращения экстремальных значений
   - Принцип постепенного изменения

3. **Определить архитектуру**
   - Где хранить адаптивные веса (в SelfState или отдельно)
   - Как интегрировать с существующими статическими весами
   - Механизм обновления весов

### Этап 2: Реализация модификации весов значимости (2-3 дня)
1. **Обновить метод appraisal()**
   - Добавить расчет адаптивных весов на основе learning_params
   - Интегрировать с существующими статическими весами
   - Добавить ограничения диапазона

2. **Реализовать формулу адаптации**
   ```
   adaptive_weight = base_weight * (1.0 + sensitivity_modifier)
   где sensitivity_modifier = (sensitivity - 0.5) * adaptation_factor
   ```

3. **Добавить логирование изменений**
   - Запись изменений весов для анализа
   - Мониторинг адаптивного поведения

### Этап 3: Обновление весов влияния (impact_model) (2-3 дня)
1. **Расширить адаптацию на base_impacts**
   - Аналогичный механизм для базовых воздействий
   - Учет learning_params для модификации влияния

2. **Реализовать постепенное изменение**
   - Предотвращение резких скачков
   - Ограничение максимального изменения за раз

3. **Интеграция с существующими модификаторами**
   - Совместная работа со статическими весами
   - Сохранение обратной совместимости

### Этап 4: Тестирование и валидация (3-4 дня)
1. **Модульные тесты**
   - Тесты адаптивных весов для разных типов событий
   - Тесты ограничений диапазона
   - Тесты постепенного изменения

2. **Интеграционные тесты**
   - Тесты с полным runtime loop
   - Тесты адаптации на основе learning_params
   - Тесты сохранения/загрузки состояния

3. **Анализ поведения**
   - Мониторинг изменения весов со временем
   - Проверка соответствия архитектурным принципам

### Этап 5: Документация и финализация (1-2 дня)
1. **Обновить документацию MeaningEngine**
   - Описать механизм адаптивных весов
   - Документировать формулы и ограничения
   - Обновить примеры использования

2. **Добавить примеры**
   - Примеры адаптации весов
   - Сценарии тестирования

3. **Финальное тестирование**
   - Полная регрессия всех тестов
   - Проверка производительности

## Архитектурные принципы

### Соответствие ограничениям Learning
- ✅ **Медленное изменение:** веса изменяются постепенно (< 0.01 за раз)
- ✅ **Без целей:** изменения на основе статистики, не для достижения цели
- ✅ **Без оптимизации:** фиксация изменений без оценки "лучше/хуже"

### Принцип медленного изменения
- Максимальное изменение веса за раз: ±0.05
- Диапазон адаптивных весов: 0.1 - 3.0 (относительно базовых)
- Постепенное накопление изменений через learning_params

### Обратная совместимость
- Существующие статические веса остаются базовыми
- Адаптивные веса накладываются как модификатор
- При отсутствии learning_params используются только статические веса

## Риски и mitigation

### Риск 1: Слишком резкие изменения
**Mitigation:** Ограничение максимального изменения за раз, плавная интерполяция

### Риск 2: Потеря стабильности системы
**Mitigation:** Тщательное тестирование, ограничения диапазона, мониторинг

### Риск 3: Нарушение архитектурных принципов
**Mitigation:** Проверка соответствия ограничениям Learning и Intelligence

## Критерии успеха

1. ✅ **Адаптивные веса реализованы** - веса изменяются на основе learning_params
2. ✅ **Принцип медленного изменения соблюден** - изменения постепенные
3. ✅ **Архитектурная совместимость** - соответствие принципам Learning
4. ✅ **Тестовое покрытие** - >95% новых функций
5. ✅ **Документация обновлена** - полное описание механизма
6. ✅ **Производительность** - без degradation runtime loop

## Временная оценка
- **Общее время:** 9-12 дней
- **Этапы:** 1-2 + 2-3 + 2-3 + 3-4 + 1-2 дней
- **Приоритет:** Высокий (расширение функциональности существующих модулей)

## Следующие шаги после реализации
- Интеграция с Learning для автоматического обновления learning_params
- Мониторинг адаптивного поведения в production
- Возможное расширение на другие параметры MeaningEngine

---
**Создано:** 2026-01-21
**Статус:** Активный план реализации
