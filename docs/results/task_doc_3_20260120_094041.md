# Отчет: Документация задачи #3

> **Дата создания:** 2026-01-20
> **Сессия:** 20260120_094041
> **Тип:** Документация задачи

## Резюме

Создана подробная техническая документация для задачи #3 из TODO листа: **"Субъективное время (Subjective Time) как “сквозная ось” жизни"**.

Документация описывает, как добавить вторую ось времени (subjective) поверх уже существующей физической шкалы (`SelfState.age`, `ticks`), не нарушая философию проекта (ADR 001) и многослойную архитектуру (ADR 002).

## Созданные документы

### 1. Основная документация задачи

- **Файл**: `docs/planning/task_3_20260120_094041.md`
- **Покрытие требований**:
  - ✅ Техническое описание задачи
  - ✅ Архитектурные решения и обоснование
  - ✅ Пошаговый план реализации
  - ✅ Риски и митигация
  - ✅ Критерии приемки
  - ✅ Связи с другими задачами и компонентами

### 2. Отчет о создании документации

- **Файл**: `docs/results/task_doc_3_20260120_094041.md` (текущий файл)

## Ключевые архитектурные решения

### 1) “Сквозная ось” без нарушения принципов

- **Subjective time — метрика, не управление**: фиксируется и визуализируется, но не используется для оптимизации поведения или появления “целей”.
- **Единая точка обновления**: Runtime Loop — единственное место, где время “движется” (соответствие ADR 002).

### 2) Минимально достаточная модель вычисления

Зафиксированы требования к модели:

- **Монотонность**: \(dS \ge 0\)
- **Ограничение скорости**: \(rate \in [r_{min}, r_{max}]\)
- **Детерминированность и прозрачность**: явная формула `rate = clamp(...)`

### 3) Обратная совместимость данных

- `MemoryEntry.subjective_timestamp` предполагается как `Optional[float] = None`, чтобы:
  - старые записи оставались валидными;
  - снапшоты/история не ломались при чтении.

## План реализации (в документации)

План разбит на этапы:

1. Проектирование полей и контрактов данных (SelfState/MemoryEntry/monitor).
2. Изменения в `SelfState` и совместимость snapshot.
3. Интеграция расчёта в `src/runtime/loop.py`.
4. Протяжка `subjective_timestamp` в `MemoryEntry` и запись для новых событий/feedback.
5. Обновление мониторинга (physical vs subjective).
6. Тестирование инвариантов (монотонность, диапазоны, влияние факторов).

## Риски и митигация (в документации)

Выделены ключевые риски:

- **Архитектурный дрейф**: субъективное время начнет управлять поведением → запретить использование как цели/оптимизации в рамках задачи.
- **Скачки/нестабильность** из-за формулы rate → clamp, мягкая зависимость, тесты.
- **Поломка сериализации/совместимости** → `Optional` поля, тесты загрузки старых данных.
- **Непонимание наблюдателем расхождения шкал** → показывать обе шкалы и (опционально) `rate`/дельту.

## Критерии приемки (в документации)

Определены критерии:

- **Функциональные**: добавлены поля в `SelfState`, loop обновляет `subjective_time`, `MemoryEntry` получает `subjective_timestamp`, мониторинг показывает/логирует, добавлены тесты.
- **Нефункциональные**: соответствие ADR 001/002, обратная совместимость данных.

## Связи с другими задачами и компонентами

- **Связь с задачей #2** (разгрузка `src/runtime/loop.py`): расчёт субъективного времени — кандидат на вынос в отдельную “политику времени” после рефакторинга loop.
- **Связь с задачей #4** (консистентность state между API и runtime): `subjective_time` должен публиковаться вместе с остальным состоянием через immutable snapshot для API.
- **Связь с observability**: `subjective_time`/`subjective_rate` — естественные метрики для структурированных логов и трассировки.

## Соответствие требованиям пользователя

- ✅ **Файл план-документа создан**: `docs/planning/task_3_20260120_094041.md`
- ✅ **Файл отчета создан**: `docs/results/task_doc_3_20260120_094041.md`
- ✅ **Согласование с концепцией выполнено**: учтены ADR 001/002 и текущие компоненты (`SelfState`, `MemoryEntry`, monitor, loop)

---

**Статус:** ✅ Завершено
**Дата завершения:** 2026-01-20
