# План выполнения задачи: Создание библиотеки готовых сценариев "жизненных историй"

## Цель задачи
Создать библиотеку готовых сценариев "жизненных историй" для системы Life - коллекцию экспериментальных сценариев развития, расширяющих внутренний мир системы без нарушения основной логики существования.

## Анализ текущего состояния
- **Реализованные сценарии**: Clarity Moments (моменты ясности) - полностью реализован и интегрирован
- **Плановые сценарии**: Internal Rhythms, Memory Echo, Silence Awareness - концептуально определены, требуют реализации
- **Архитектурные принципы**: Экспериментальность, интеграция без изменения интерфейсов, опциональность, наблюдаемость
- **Текущая структура**: Базовый фреймворк в `src/experimental/` с одним реализованным сценарием

## Структура плана выполнения

### Этап 1: Анализ и проектирование ✅ ВЫПОЛНЕНО
- [x] **Анализ существующих сценариев**: Clarity Moments полностью изучен
- [x] **Изучение архитектуры**: Понимание паттернов интеграции и SelfState расширений
- [x] **Определение требований**: Формализация требований к библиотеке сценариев

### Этап 2: Проектирование общего фреймворка
- [ ] **Базовый класс Scenario**: Абстрактный базовый класс для всех сценариев
  - Стандартизированные методы: `check_conditions()`, `activate()`, `update()`, `deactivate()`
  - Общие паттерны логирования и состояния
  - Конфигурационные параметры
- [ ] **Интерфейсы интеграции**: Стандартизированные интерфейсы для runtime loop
- [ ] **Система конфигурации**: Управление включением/отключением сценариев
- [ ] **Реестр сценариев**: Централизованное управление всеми доступными сценариями

### Этап 3: Реализация сценариев

#### Internal Rhythms - Внутренние ритмы жизни
- [ ] **Концепция**: Циркадные ритмы активности/покоя системы
- [ ] **Механизм**: Периоды ~100-200 тиков с фазами бодрствования/сна
- [ ] **Влияние**: Модификация восприимчивости к событиям в зависимости от фазы
- [ ] **Интеграция**: Влияние на appraisal в MeaningEngine
- [ ] **Тестирование**: Проверка цикличности и эффектов на восприимчивость

#### Memory Echo - Эхо памяти
- [ ] **Концепция**: Спонтанная активация воспоминаний прошлого опыта
- [ ] **Механизм**: Временные/вероятностные триггеры активации воспоминаний
- [ ] **Влияние**: Создание внутренних "эхо-событий" для рефлексии
- [ ] **Интеграция**: Использование Activation и Memory компонентов
- [ ] **Тестирование**: Проверка активации воспоминаний и создания эхо-событий

#### Silence Awareness - Осознание тишины
- [ ] **Концепция**: Способность к внутренней рефлексии в моменты отсутствия событий
- [ ] **Механизм**: Детекция периодов без внешних событий, анализ тишины
- [ ] **Влияние**: Активация внутренних процессов самоанализа
- [ ] **Интеграция**: Работа с EventQueue и внутренними состояниями
- [ ] **Тестирование**: Проверка детекции тишины и рефлексивных эффектов

### Этап 4: Система управления сценариями
- [ ] **ScenarioManager**: Централизованный менеджер всех сценариев
  - Регистрация и активация сценариев
  - Управление состоянием каждого сценария
  - Координация между сценариями
- [ ] **Конфигурационная система**: Параметры включения/отключения
- [ ] **Мониторинг**: API для получения статуса всех сценариев
- [ ] **Горячая перезагрузка**: Возможность изменения конфигурации без перезапуска

### Этап 5: Интеграция и расширение SelfState
- [ ] **Новые поля SelfState**: Добавление полей для каждого сценария
  - Internal Rhythms: `rhythm_phase`, `rhythm_modifier`, `rhythm_cycle`
  - Memory Echo: `echo_active`, `echo_memory_id`, `echo_intensity`
  - Silence Awareness: `silence_duration`, `silence_reflection`, `silence_threshold`
- [ ] **Валидация**: Обновление FieldValidator для новых полей
- [ ] **Сериализация**: Поддержка сохранения/восстановления состояния сценариев

### Этап 6: Интеграция в Runtime Loop
- [ ] **Обновление loop.py**: Интеграция ScenarioManager в основной цикл
- [ ] **Порядок выполнения**: Определение правильной последовательности активации сценариев
- [ ] **Обработка ошибок**: Изоляция сбоев в сценариях от основного цикла
- [ ] **Производительность**: Оптимизация для минимального влияния на основной цикл

### Этап 7: Тестирование и валидация
- [ ] **Unit тесты**: Для каждого сценария отдельно
- [ ] **Integration тесты**: Взаимодействие сценариев с компонентами системы
- [ ] **End-to-end тесты**: Полная валидация с запущенным runtime loop
- [ ] **Performance тесты**: Проверка влияния на производительность
- [ ] **Конфигурационные тесты**: Проверка включения/отключения сценариев

### Этап 8: Документация и примеры
- [ ] **Обновление docs/experimental/README.md**: Полная документация библиотеки
- [ ] **Документация API**: Спецификация интерфейсов и методов
- [ ] **Примеры использования**: Практические примеры для каждого сценария
- [ ] **Руководство по конфигурации**: Как настраивать и комбинировать сценарии
- [ ] **Диагностика**: Инструкции по отладке и мониторингу сценариев

## Архитектурные принципы библиотеки

### Общие требования ко всем сценариям
1. **Опциональность**: Все сценарии можно отключить без потери функциональности
2. **Наблюдаемость**: Полное логирование всех состояний и переходов
3. **Изоляция**: Не влияют на критическую функциональность системы
4. **Интеграция**: Используют существующие компоненты без изменений интерфейсов
5. **Тестируемость**: Полное покрытие unit и integration тестами
6. **Производительность**: Минимальное влияние на основной runtime цикл

### Структура сценария
```python
class LifeScenario(ABC):
    """Базовый класс для всех жизненных сценариев"""

    @abstractmethod
    def check_conditions(self, self_state) -> Optional[Dict[str, Any]]:
        """Проверка условий активации сценария"""
        pass

    @abstractmethod
    def activate(self, self_state) -> None:
        """Активация сценария"""
        pass

    @abstractmethod
    def update(self, self_state) -> bool:
        """Обновление состояния сценария в тике"""
        pass

    @abstractmethod
    def deactivate(self, self_state) -> None:
        """Деактивация сценария"""
        pass

    @abstractmethod
    def get_status(self, self_state) -> Dict[str, Any]:
        """Получение текущего статуса сценария"""
        pass
```

## Риски и сложности
- **Производительность**: Новые сценарии не должны замедлять основной цикл >5%
- **Концептуальная чистота**: Сценарии не должны нарушать философию Life
- **Взаимодействие**: Потенциальные конфликты между сценариями
- **Тестируемость**: Сложность тестирования вероятностных и временных механизмов
- **Масштабируемость**: Фреймворк должен поддерживать добавление новых сценариев

## Ожидаемые результаты
- **Библиотека из 4 сценариев**: Clarity Moments + Internal Rhythms + Memory Echo + Silence Awareness
- **Общий фреймворк**: Переиспользуемая архитектура для будущих сценариев
- **Полная интеграция**: Сценарии интегрированы в runtime loop с минимальным влиянием
- **Комплексное тестирование**: 95%+ покрытие кода тестами
- **Документация**: Полная документация с примерами и руководствами
- **API для управления**: Программное включение/отключение и мониторинг сценариев

## Временные оценки
- **Этап 1**: Анализ - 4 часа ✅
- **Этап 2**: Фреймворк - 8 часов
- **Этап 3**: Реализация сценариев - 24 часа (8 часов на сценарий)
- **Этап 4**: Система управления - 6 часов
- **Этап 5**: SelfState расширение - 4 часа
- **Этап 6**: Runtime интеграция - 6 часов
- **Этап 7**: Тестирование - 12 часов
- **Этап 8**: Документация - 6 часов

**Общее время: 70 часов**

---
*План создан: 2026-01-21*
*Ответственный: Project Executor Agent*