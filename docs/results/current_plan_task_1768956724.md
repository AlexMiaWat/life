# План выполнения задачи: Добавить тесты на деградацию системы (падение energy/integrity/stability до 0)

**ID задачи:** 1768956724
**Дата создания:** 2026-01-21
**Статус:** Активный

## Анализ текущего состояния

### Существующие тесты деградации
- Файл: `src/test/test_degradation.py` (1079 строк кода)
- Покрывает базовую деградацию параметров
- Включает интеграционные тесты с runtime loop
- Имеет тесты на длительную работу (1000+ тиков)

### Архитектура деградации
- **LifePolicy**: Управляет логикой слабости и штрафов
  - `is_weak()`: проверка на слабость при параметрах ≤ 0.05
  - `weakness_penalty()`: штрафы за слабость (0.02 * dt для каждого параметра)
- **SelfState.apply_delta()**: Применяет изменения с clamping до 0
- **Runtime Loop**: Применяет weakness penalty при обнаружении слабости

### Философия Life
- **"Смерти нет — только слабость и бессилие"**
- Система продолжает функционировать при параметрах ≤ 0
- `is_active()` всегда возвращает True для деградированных состояний

## План выполнения

### Этап 1: Анализ существующих тестов
- [x] Изучить `test_degradation.py`
- [x] Определить текущий уровень покрытия
- [x] Выявить пробелы в тестах на падение до 0

### Этап 2: Определение пробелов
**Текущие тесты проверяют:**
- Падение параметров до 0 через apply_delta
- Поведение active flag (остается True)
- Интеграцию с weakness penalty
- Длительную работу с деградацией

**Пробелы в покрытии:**
1. **Изолированные тесты падения до 0** для каждого параметра отдельно
2. **Тесты поведения при точном значении 0.0**
3. **Тесты на одновременное падение всех параметров до 0**
4. **Тесты восстановления из состояния полной деградации**
5. **Edge cases при переходе через границу 0**

### Этап 3: Реализация новых тестов

#### 3.1 Тесты на изолированное падение до 0
```python
# Для каждого параметра отдельно
def test_energy_falls_to_zero_isolated():
def test_integrity_falls_to_zero_isolated():
def test_stability_falls_to_zero_isolated():
```

#### 3.2 Тесты на точное значение 0.0
```python
# Проверка поведения при установке в 0.0
def test_zero_energy_exact_value():
def test_zero_integrity_exact_value():
def test_zero_stability_exact_value():
```

#### 3.3 Тесты на одновременную деградацию
```python
def test_all_parameters_to_zero_simultaneously():
def test_system_continues_with_all_zero():
```

#### 3.4 Тесты на восстановление
```python
def test_recovery_from_zero_energy():
def test_recovery_from_all_zero_state():
```

### Этап 4: Верификация и интеграция
- Запуск всех тестов деградации
- Проверка покрытия кода
- Интеграция с CI/CD pipeline

## Критерии успеха

### Функциональные
- [ ] Все новые тесты проходят
- [ ] Существующие тесты не сломаны
- [ ] Покрытие деградации ≥ 95%

### Качественные
- [ ] Тесты изолированы и независимы
- [ ] Четкие имена и описания
- [ ] Покрытие edge cases

## Риски и mitigation

### Риск: Изменение поведения системы
**Mitigation:** Тщательное изучение существующего кода перед добавлением тестов

### Риск: Конфликт с существующими тестами
**Mitigation:** Запуск полного тест-сьюта перед коммитом

### Риск: Недостаточное покрытие edge cases
**Mitigation:** Code review и анализ граничных условий

## Временная оценка
- Этап 1: Анализ - 1 час
- Этап 2: Планирование - 30 мин
- Этап 3: Реализация - 4-6 часов
- Этап 4: Верификация - 1 час
- **Итого:** 6-8 часов

## Следующие шаги
1. Начать анализ существующих тестов
2. Определить конкретные тестовые случаи
3. Реализовать новые тесты
4. Провести интеграционное тестирование
