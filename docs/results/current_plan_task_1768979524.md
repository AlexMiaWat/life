# План реализации вероятностного распределения новых событий (14.3% от потока)

**Дата:** 2026-01-21
**Задача:** task_1768979524
**Цель:** Реализовать вероятностное распределение новых событий, составляющих ровно 14.3% от общего потока событий в системе Life

---

## Обзор

Данная задача направлена на корректировку весов вероятностного распределения событий в `EventGenerator`, чтобы новые типы событий (17 типов: social, cognitive, existential) составляли ровно 14.3% от общего потока, а основные типы событий (5 типов: noise, decay, recovery, shock, idle) - 85.7%.

---

## Текущее состояние

### Анализ EventGenerator
- **Всего типов событий:** 23 (memory_echo имеет вес 0.0, генерируется только внутренне)
- **Основные типы:** 5 типов с исходными весами, суммирующимися до ~80.6%
- **Новые типы:** 17 типов с исходными весами, суммирующимися до ~19.4%
- **Текущее распределение:** Новые события составляют 19.4% вместо требуемых 14.3%

### Типы событий

#### Основные события (85.7% потока)
- `noise`: 0.352 (было 0.33)
- `decay`: 0.244 (было 0.23)
- `recovery`: 0.180 (было 0.17)
- `shock`: 0.040 (было 0.038)
- `idle`: 0.040 (было 0.038)

#### Новые события (14.3% потока)
- `social_presence`: 0.014 (было 0.019)
- `social_conflict`: 0.010 (было 0.014)
- `social_harmony`: 0.010 (было 0.014)
- `cognitive_doubt`: 0.014 (было 0.019)
- `cognitive_clarity`: 0.010 (было 0.014)
- `cognitive_confusion`: 0.014 (было 0.019)
- `existential_void`: 0.007 (было 0.009)
- `existential_purpose`: 0.006 (было 0.008)
- `existential_finitude`: 0.008 (было 0.011)
- `connection`: 0.007 (было 0.01)
- `isolation`: 0.007 (было 0.01)
- `insight`: 0.007 (было 0.01)
- `confusion`: 0.007 (было 0.01)
- `curiosity`: 0.007 (было 0.01)
- `meaning_found`: 0.007 (было 0.01)
- `void`: 0.007 (было 0.01)
- `acceptance`: 0.007 (было 0.01)

---

## План действий

### 1. Анализ текущего распределения
**Цель:** Получить точные данные о текущих весах и распределении

**Задачи:**
- Изучить код `EventGenerator` и текущие веса
- Рассчитать текущий процент новых событий (19.4%)
- Определить целевое распределение (14.3% новые, 85.7% основные)

### 2. Расчет новых весов
**Цель:** Вычислить скорректированные веса для достижения целевого распределения

**Задачи:**
- Рассчитать коэффициенты корректировки для основных и новых событий
- Провести поэлементную корректировку весов
- Убедиться, что сумма всех весов равна 1.0
- Проверить достижение точного процента 14.3%

### 3. Реализация изменений
**Цель:** Обновить код EventGenerator с новыми весами

**Задачи:**
- Обновить массив weights в `EventGenerator.generate()`
- Добавить комментарии с объяснением корректировки
- Сохранить обратную совместимость интенсивностей событий

### 4. Валидация распределения
**Цель:** Проверить корректность нового распределения

**Задачи:**
- Провести статистический анализ сгенерированных событий
- Убедиться, что новые события составляют ~14.3% потока
- Проверить сохранение разнообразия типов событий

### 5. Тестирование
**Цель:** Подтвердить работоспособность системы

**Задачи:**
- Запустить unit-тесты EventGenerator
- Провести интеграционное тестирование с runtime loop
- Проверить отсутствие регрессий в других компонентах

---

## Критерии успеха

- Новые события составляют ровно 14.3% ±0.1% от общего потока
- Основные события составляют 85.7% ±0.1% от общего потока
- Сумма всех весов равна 1.0
- Все тесты проходят успешно
- Распределение статистически стабильно

---

## Риски и ограничения

- **Статистическая вариативность:** При малом количестве генераций процент может отклоняться
- **Архитектурные ограничения:** Необходимо сохранить баланс между типами событий
- **Производительность:** Корректировка весов не должна влиять на производительность генерации
- **Совместимость:** Изменения не должны ломать существующие тесты и интеграции

---

## Контрольные точки

### После этапа 1 (Анализ):
- Текущий процент новых событий: 19.4% ✅
- Целевое распределение определено: 14.3%/85.7% ✅

### После этапа 2 (Расчет):
- Коэффициенты корректировки рассчитаны
- Новые веса просуммированы и проверены

### После этапа 3 (Реализация):
- Код EventGenerator обновлен
- Комментарии добавлены

### После этапа 4 (Валидация):
- Статистический анализ проведен
- Процент новых событий подтвержден

### После этапа 5 (Тестирование):
- Все тесты проходят
- Интеграция подтверждена

---

**Статус:** План утвержден, реализация начата