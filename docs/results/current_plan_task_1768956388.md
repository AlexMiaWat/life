# План выполнения задачи: Интегрировать в генератор событий с соответствующими интенсивностями

## Цель задачи
Интегрировать адаптивные веса значимости из MeaningEngine (learning_params.event_type_sensitivity) в генератор событий, чтобы система могла адаптировать частоту генерации различных типов событий на основе накопленного опыта.

## Текущий статус реализации
✅ **MeaningEngine имеет адаптивные веса** - реализованы модификаторы значимости на основе learning_params.event_type_sensitivity
✅ **Генератор событий имеет базовые веса** - статические вероятности генерации различных типов событий
✅ **Новые типы событий интегрированы** - социальные, когнитивные и экзистенциальные события с соответствующими интенсивностями
❌ **Адаптивная генерация отсутствует** - генератор не использует learning_params для модификации весов

## Анализ текущей реализации генератора

### Статические веса генерации (в EventGenerator.generate())
```python
weights = [
    0.33,  # noise (уменьшен для новых событий)
    0.23,  # decay (уменьшен для новых событий)
    0.17,  # recovery (уменьшен для новых событий)
    0.038, # shock (уменьшен для новых событий)
    0.038, # idle (уменьшен для новых событий)
    0.0,   # memory_echo (генерируется только внутренне)
    0.019, # social_presence
    0.014, # social_conflict
    0.014, # social_harmony
    # ... остальные новые типы с весом 0.01
]
```

### Адаптивные веса в MeaningEngine (event_type_sensitivity)
- Диапазон значений: [0.0, 1.0] (по умолчанию 0.2)
- Интерпретируется как чувствительность к типу события
- Высокая чувствительность = событие кажется более значимым

## План реализации адаптивной генерации

### Этап 1: Анализ и проектирование (1-2 дня)
1. **Изучить механизм learning_params.event_type_sensitivity**
   - Как формируются значения чувствительности
   - Диапазон и интерпретация значений
   - Связь с частотой генерации событий

2. **Спроектировать систему адаптивных весов генерации**
   - Формула модификации базовых весов на основе чувствительности
   - Ограничения для предотвращения экстремальных вероятностей
   - Принцип постепенного изменения частоты генерации

3. **Определить архитектуру интеграции**
   - Как передать learning_params в генератор
   - Механизм обновления весов генерации
   - Обратная совместимость с существующими вызовами

### Этап 2: Реализация адаптивных весов генерации (2-3 дня)
1. **Обновить конструктор EventGenerator**
   - Добавить параметр learning_params (опциональный)
   - Добавить метод для обновления параметров

2. **Реализовать формулу адаптации весов**
   ```
   adaptive_weight = base_weight * (1.0 + sensitivity_modifier)
   где sensitivity_modifier = (sensitivity - 0.5) * adaptation_factor
   ```

3. **Добавить механизм нормализации весов**
   - После применения модификаторов нормализовать веса
   - Сохранить относительные пропорции
   - Предотвратить нулевые или отрицательные веса

### Этап 3: Интеграция с SelfState (2-3 дня)
1. **Обновить вызовы генератора в runtime loop**
   - Передать learning_params из SelfState в генератор
   - Реализовать периодическое обновление весов

2. **Добавить метод update_weights() в EventGenerator**
   - Принимать learning_params и adaptation_params
   - Вычислять новые адаптивные веса
   - Обновлять внутреннее состояние генератора

3. **Интегрировать с CLI генератором**
   - Обновить generator_cli.py для поддержки адаптивных весов
   - Добавить опцию для передачи learning_params

### Этап 4: Тестирование и валидация (3-4 дня)
1. **Модульные тесты**
   - Тесты адаптивных весов для разных значений чувствительности
   - Тесты нормализации весов
   - Тесты граничных случаев

2. **Интеграционные тесты**
   - Тесты с полным runtime loop
   - Тесты адаптации генерации на основе learning_params
   - Тесты сохранения/загрузки состояния

3. **Анализ поведения**
   - Мониторинг изменения частоты генерации событий
   - Проверка соответствия архитектурным принципам

### Этап 5: Документация и финализация (1-2 дня)
1. **Обновить документацию EventGenerator**
   - Описать механизм адаптивных весов генерации
   - Документировать формулы и ограничения
   - Обновить примеры использования

2. **Добавить примеры**
   - Примеры адаптивной генерации событий
   - Сценарии тестирования с различными learning_params

3. **Финальное тестирование**
   - Полная регрессия всех тестов
   - Проверка производительности

## Архитектурные принципы

### Соответствие ограничениям Learning
- ✅ **Медленное изменение:** частота генерации изменяется постепенно
- ✅ **Без целей:** изменения на основе статистики, не для достижения цели
- ✅ **Без оптимизации:** фиксация изменений без оценки "лучше/хуже"

### Принцип адаптивной генерации
- Максимальное изменение веса: ±50% от базового (через sensitivity_modifier)
- Диапазон адаптивных весов: 0.1x - 3.0x от базовых
- Постепенное накопление изменений через learning_params

### Обратная совместимость
- Существующие вызовы генератора работают без изменений
- При отсутствии learning_params используются только базовые веса
- Опциональный параметр learning_params

## Риски и mitigation

### Риск 1: Слишком резкие изменения частоты
**Mitigation:** Ограничение максимального изменения весов, плавная интерполяция

### Риск 2: Нарушение баланса типов событий
**Mitigation:** Нормализация весов после модификации, сохранение относительных пропорций

### Риск 3: Нарушение архитектурных принципов
**Mitigation:** Проверка соответствия ограничениям Learning и Intelligence

## Критерии успеха

1. ✅ **Адаптивные веса реализованы** - генератор использует learning_params для модификации частоты генерации
2. ✅ **Принцип медленного изменения соблюден** - изменения частоты постепенные
3. ✅ **Архитектурная совместимость** - соответствие принципам Learning
4. ✅ **Тестовое покрытие** - >95% новых функций
5. ✅ **Документация обновлена** - полное описание механизма
6. ✅ **Производительность** - без degradation runtime loop

## Временная оценка
- **Общее время:** 9-12 дней
- **Этапы:** 1-2 + 2-3 + 2-3 + 3-4 + 1-2 дней
- **Приоритет:** Высокий (расширение функциональности существующих модулей)

## Следующие шаги после реализации
- Тестирование адаптивного поведения в длительных экспериментах
- Мониторинг влияния на обучение и адаптацию
- Возможное расширение на другие параметры генерации

---
**Создано:** 2026-01-21
**Статус:** Активный план реализации
