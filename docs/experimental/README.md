# Экспериментальные возможности системы Life

## Обзор

Этот раздел содержит документацию по экспериментальным возможностям системы Life. Эти возможности расширяют внутренний мир системы без нарушения основной логики существования.

## Clarity Moments - Система моментов ясности

### Назначение

**Моменты ясности** - это особые состояния системы Life, которые возникают при определенных условиях (высокая стабильность и энергия) и временно повышают восприимчивость к событиям внешнего мира.

### Архитектурные принципы

1. **Экспериментальность**: Система полностью опциональна и может быть отключена
2. **Интеграция**: Использует существующие компоненты без изменения интерфейсов
3. **Наблюдаемость**: Все состояния логируются для анализа поведения
4. **Ограниченность**: Моменты ясности имеют фиксированную длительность

### Компоненты

#### ClarityMoments класс
Расположение: `src/experimental/clarity_moments.py`

Основные методы:
- `check_clarity_conditions()` - проверка условий активации
- `activate_clarity_moment()` - активация момента ясности
- `update_clarity_state()` - обновление состояния в тиках
- `deactivate_clarity_moment()` - деактивация момента ясности

#### Новые поля SelfState
```python
clarity_state: bool = False      # Флаг активности момента ясности
clarity_duration: int = 0       # Оставшаяся длительность в тиках
clarity_modifier: float = 1.0   # Модификатор значимости событий
```

### Условия активации

Момент ясности активируется при следующих условиях:
- **Стабильность** > 0.8 (высокая стабильность)
- **Энергия** > 0.7 (достаточный уровень энергии)
- **Clarity не активен** (нет overlapping состояний)
- **Интервал проверки** (>= 10 тиков между проверками)

### Механизм работы

1. **Проверка условий**: Каждые 10 тиков проверяются условия активации
2. **Создание события**: При активации создается событие `clarity_moment`
3. **Усиление восприятия**: MeaningEngine усиливает значимость событий на 1.5x
4. **Ограниченная длительность**: Состояние активно 50 тиков (примерно 5 секунд)
5. **Автоматическая деактивация**: По истечении времени состояние сбрасывается

### Интеграция с компонентами

#### Runtime Loop
- ClarityMoments интегрирован в основной цикл
- Проверка условий происходит после обновления внутренних ритмов
- Создание событий добавляется в EventQueue

#### MeaningEngine
- При appraisal учитывается clarity_modifier
- Значимость событий умножается на модификатор (1.5 при clarity)
- Не влияет на базовую логику оценки

#### SelfState
- Новые поля сохраняются в snapshot
- Валидация через FieldValidator
- Поддержка сериализации/десериализации

### Логирование

Система ClarityMoments логирует:
- Активацию моментов ясности с параметрами состояния
- Деактивацию с итоговой статистикой
- Текущее состояние через StructuredLogger

### Конфигурация

#### Включение/отключение
```python
run_loop(
    # ...
    disable_clarity_moments=False,  # True для отключения
    # ...
)
```

#### Настраиваемые параметры
```python
# В ClarityMoments классе
CLARITY_STABILITY_THRESHOLD = 0.8
CLARITY_ENERGY_THRESHOLD = 0.7
CLARITY_DURATION_TICKS = 50
CLARITY_SIGNIFICANCE_BOOST = 1.5
CLARITY_CHECK_INTERVAL = 10
```

### Тестирование

#### Unit тесты
- `src/test/test_clarity_moments.py` - базовая функциональность
- Проверка условий активации/деактивации
- Тестирование состояний и модификаторов

#### Integration тесты
- `src/test/test_clarity_moments_integration.py` - интеграция с runtime loop
- Тестирование с MeaningEngine
- Проверка создания событий

### Примеры использования

#### Ручное тестирование
```bash
# Запуск с включенными clarity moments
python -c "
from src.runtime.loop import run_loop
from src.state.self_state import SelfState
import threading

state = SelfState()
state.stability = 0.9
state.energy = 0.8

stop_event = threading.Event()
run_loop(state, lambda: None, stop_event=stop_event, disable_clarity_moments=False)
"
```

#### Мониторинг
```python
# Получение статуса clarity
clarity_moments.get_clarity_status(self_state)
# {
#     'active': True,
#     'duration_remaining': 25,
#     'total_events': 3,
#     'modifier': 1.5
# }
```

### Будущие улучшения

1. **Адаптивные пороги**: Динамическая настройка условий активации
2. **Множественные типы clarity**: Разные виды моментов ясности
3. **Влияние на другие компоненты**: Расширение эффектов clarity
4. **Статистика**: Детальный анализ частоты и продолжительности

## Другие экспериментальные возможности

*В разработке:*
- Internal Rhythms (внутренние ритмы жизни)
- Memory Echo (эхо памяти)
- Silence Awareness (осознание тишины)

## Безопасность и ограничения

- **Опциональность**: Все экспериментальные возможности можно отключить
- **Изоляция**: Не влияют на критическую функциональность
- **Мониторинг**: Полное логирование для анализа поведения
- **Тестирование**: Высокий уровень покрытия тестами
