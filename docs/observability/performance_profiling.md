# –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Runtime Loop

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ Life –≤–∫–ª—é—á–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ runtime loop —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `cProfile`. –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã—è–≤–ª—è—Ç—å bottleneck'—ã –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—É—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ** (2026-01-20)

## –í–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É

```bash
python src/main_server_api.py --profile --tick-interval 1.0 --snapshot-period 10
```

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ

```python
from runtime.loop import run_loop

run_loop(
    self_state=state,
    monitor=console_monitor,
    tick_interval=1.0,
    enable_profiling=True  # –í–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
)
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `data/runtime_loop_profile_{timestamp}.prof`

**–§–æ—Ä–º–∞—Ç:** –ë–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã `.prof` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —á–µ—Ä–µ–∑ `pstats` –∏–ª–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `snakeviz`

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑

–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Ç–æ–ø-10 —Ñ—É–Ω–∫—Ü–∏–π –ø–æ cumulative time:

```
2026-01-20 14:45:23,456 - INFO - Profile saved to data/runtime_loop_profile_1768946723.prof
2026-01-20 14:45:23,456 - INFO - Top 10 functions by cumulative time:
1. time.sleep (5.004s, 99.5%) - ncalls: 1
2. threading.Lock.acquire (0.023s, 0.5%) - ncalls: 54
...
```

## Baseline —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (2026-01-20)

### –û–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏

- **–û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 5.027 —Å–µ–∫—É–Ω–¥
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π:** 54
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:** 38

### –¢–æ–ø –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –≤—Ä–µ–º–µ–Ω–∏

#### –ü–æ cumulative time (–≤–∫–ª—é—á–∞—è –≤—ã–∑—ã–≤–∞–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏):

1. **`time.sleep`** - 5.004 —Å–µ–∫ (99.5%)
   - –û—Å–Ω–æ–≤–Ω–æ–µ –≤—Ä–µ–º—è —Ç—Ä–∞—Ç–∏—Ç—Å—è –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ –º–µ–∂–¥—É —Ç–∏–∫–∞–º–∏
   - **–í—ã–≤–æ–¥:** Intentional delay, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

2. **Threading operations** - 0.023 —Å–µ–∫ (0.5%)
   - –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ (`_thread.lock.acquire`)
   - –û–ø–µ—Ä–∞—Ü–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è —Ç—Ä–µ–¥–æ–≤ (`threading.py`)

#### –ü–æ internal time (—Ç–æ–ª—å–∫–æ –≤—Ä–µ–º—è –≤ —Å–∞–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏):

1. **`time.sleep`** - 5.004 —Å–µ–∫ (99.5%)
2. **Thread lock operations** - 0.023 —Å–µ–∫ (0.5%)
3. **–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** - < 0.001 —Å–µ–∫ (< 0.02%)

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### ‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

1. **–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å runtime loop:**
   - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ Life –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç < 0.5% CPU –≤—Ä–µ–º–µ–Ω–∏
   - 99.5% –≤—Ä–µ–º–µ–Ω–∏ —Ç—Ä–∞—Ç–∏—Ç—Å—è –Ω–∞ `time.sleep` –º–µ–∂–¥—É —Ç–∏–∫–∞–º–∏
   - Runtime loop —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

2. **–û—Ç–ª–∏—á–Ω–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
   - –ü—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ (—Å–æ–±—ã—Ç–∏—è, –ø–∞–º—è—Ç—å) overhead –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º
   - Threading —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è

3. **–ù–∏–∑–∫–∏–π baseline overhead:**
   - –î–∞–∂–µ —Å –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∑—ã–≤—á–∏–≤–æ–π
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–∏

### üéØ –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –£—Å–ª–æ–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

- **time.sleep –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —ç—Ç–æ intentional delay
- **Threading overhead:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π, –Ω–æ –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å async –ø–æ–¥—Ö–æ–¥—ã

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ bottleneck'—ã (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

1. **Memory operations** (–Ω–µ –≤–∏–¥–Ω—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏–∑-–∑–∞ –º–∞–ª–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏)
   - –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è snapshots
   - –ü–æ–∏—Å–∫ –≤ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
   - –ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π

2. **I/O operations** (–Ω–µ –≤–∏–¥–Ω—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ)
   - –ó–∞–ø–∏—Å—å –ª–æ–≥–æ–≤
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ snapshots
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

3. **Event processing** (–Ω–µ –≤–∏–¥–Ω—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π —Å–æ–±—ã—Ç–∏–π
   - –í—ã–∑–æ–≤ MeaningEngine
   - Decision/Action execution

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π)

1. **Async I/O:** –ó–∞–º–µ–Ω–∞ blocking I/O –Ω–∞ async –¥–ª—è –ª—É—á—à–µ–π –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç–∏
2. **Memory pooling:** –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è GC overhead
3. **Lazy evaluation:** –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–ª—è —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–Ω–∞–ª–∏–∑–∞

### profile_runtime.py

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π:

```bash
# –ê–Ω–∞–ª–∏–∑ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
python profile_runtime.py data/runtime_loop_profile_1768946723.prof

# –ê–Ω–∞–ª–∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
python profile_runtime.py data/runtime_loop_profile_*.prof
```

### pstats (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞)

```python
import pstats

# –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
stats = pstats.Stats('data/runtime_loop_profile_1768946723.prof')
stats.sort_stats('cumulative').print_stats(10)  # –¢–æ–ø-10 –ø–æ cumulative time
```

### snakeviz (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)

```bash
pip install snakeviz
snakeviz data/runtime_loop_profile_1768946723.prof
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –Ω–µ–¥–µ–ª–∏)

1. **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π:** –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –∞–∫—Ç–∏–≤–Ω—ã–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–º —Å–æ–±—ã—Ç–∏–π
2. **Memory profiling:** –ò–∑–º–µ—Ä–∏—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ —Ä–æ—Å—Ç–µ –∏—Å—Ç–æ—Ä–∏–∏
3. **I/O profiling:** –ò–∑–º–µ—Ä–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ snapshots

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1-2 –º–µ—Å—è—Ü–∞)

1. **Async refactoring:** –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ async/await –¥–ª—è I/O –æ–ø–µ—Ä–∞—Ü–∏–π
2. **Memory optimization:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–∞–º—è—Ç–∏
3. **Caching:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —á–∞—Å—Ç—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (3+ –º–µ—Å—è—Ü–∞)

1. **Distributed processing:** –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤/–º–∞—à–∏–Ω
2. **Advanced profiling:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å APM —Å–∏—Å—Ç–µ–º–∞–º–∏ (New Relic, DataDog)
3. **Performance monitoring:** –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è

- **CPU overhead:** ~5-10% –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **Memory overhead:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –ø–∞–º—è—Ç–∏)
- **Disk overhead:** –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ `.prof` –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª–µ–Ω –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–ü—Ä–æ—Ñ–∏–ª–∏—Ä—É–π—Ç–µ representative workloads:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
2. **–ò–∑–º–µ—Ä—è–π—Ç–µ baseline —Ä–µ–≥—É–ª—è—Ä–Ω–æ:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
3. **–ö–æ–º–±–∏–Ω–∏—Ä—É–π—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ memory profilers –¥–ª—è –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω—ã
4. **–§–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ bottleneck'–∞—Ö:** –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ—Å—É—Ä—Å–æ–µ–º–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [Runtime Loop](../../components/runtime-loop.md) - –æ—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è runtime loop
- [Operational Model](operational_model.md) - –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏
- [Structured Logger](structured_logger.md) - —Å–∏—Å—Ç–µ–º–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
