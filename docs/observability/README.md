# Система наблюдаемости (Observability System)

## Обзор

Система наблюдаемости проекта Life предоставляет комплексные инструменты для мониторинга, трассировки и анализа работы экспериментального компаньона.

## Компоненты

### [StructuredLogger](structured_logger.md)
Единый интерфейс для структурированного логирования всех стадий жизненного цикла системы.

### [Operational Model](operational_model.md)
Подробное описание операционной модели наблюдаемости, форматов логов и инструментов анализа.

## Возможности

- **Структурированное логирование**: JSONL формат для машинной обработки
- **Трассировка цепочек**: Полная видимость от события до действия
- **Метрики производительности**: Автоматический сбор показателей работы
- **Корреляционные ID**: Связывание событий в причинно-следственные цепочки
- **Потокобезопасность**: Безопасная работа в многопоточной среде

## Быстрый старт

### Включение логирования

Система логирования автоматически включается при запуске Life:

```bash
python src/main_server_api.py --tick-interval 1.0 --snapshot-period 10
```

### Просмотр логов

```bash
# Просмотр логов в реальном времени
tail -f data/structured_log.jsonl

# Просмотр событий определенного типа
cat data/structured_log.jsonl | jq 'select(.stage == "event" and .data.type == "shock")'
```

### Анализ производительности

```bash
# Средняя длительность тика
cat data/structured_log.jsonl | jq -r 'select(.stage == "tick_end") | .data.tick_duration_ms' | awk '{sum+=$1; count++} END {print "Среднее:", sum/count, "мс"}'

# Распределение паттернов решений
cat data/structured_log.jsonl | jq -r 'select(.stage == "decision") | .data.pattern' | sort | uniq -c
```

## Архитектура

```
Runtime Loop
    ↓
StructuredLogger (интегрирован)
    ↓
JSONL логи → data/structured_log.jsonl
    ↓
Анализ → jq, Python скрипты, дашборды
```

## Использование

### Для разработчиков
- Отладка поведения системы
- Анализ причинно-следственных связей
- Профилирование производительности

### Для исследования
- Изучение паттернов адаптации
- Анализ эффективности решений
- Мониторинг деградации системы

### Для мониторинга
- Оперативное обнаружение проблем
- Автоматизированные алерты
- Построение метрик и дашбордов

## Файлы логов

- **`data/structured_log.jsonl`**: Основной файл структурированных логов
- **`data/tick_log.jsonl`**: Устаревший формат (сохраняется для совместимости)

## Инструменты

### jq
```bash
# Фильтрация по correlation_id
cat data/structured_log.jsonl | jq 'select(.correlation_id == "chain_001")'

# Извлечение метрик
cat data/structured_log.jsonl | jq -r 'select(.stage == "tick_end") | .data.tick_duration_ms'
```

### Python анализ
```python
import json
from collections import Counter

# Подсчет стадий
stages = Counter()
with open('data/structured_log.jsonl', 'r') as f:
    for line in f:
        entry = json.loads(line)
        stages[entry['stage']] += 1

print("Распределение стадий:", dict(stages))
```

## Производительность

- **Накладные расходы**: ~0.5-1мс на тик
- **Условное логирование**: Возможность отключения для production
- **Потокобезопасность**: Минимальное влияние на многопоточные операции

## См. также

- [Runtime Loop](../components/runtime-loop.md) - интеграция StructuredLogger
- [Архитектурные решения](../../adr/) - принципы наблюдаемости
- [Тестирование](../testing/) - тесты системы логирования
