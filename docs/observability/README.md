# Система наблюдаемости (Observability System)

## Обзор

Система наблюдаемости проекта Life предоставляет комплексные инструменты для **активного структурированного логирования** работы экспериментального компаньона.

**Архитектура:** **АКТИВНАЯ** - StructuredLogger интегрирован в runtime цикл и активно логирует ключевые стадии обработки.

**Статус:** ✅ **Стабильная активная архитектура** (2026-01-22)

## [Архитектура системы](architecture.md) ⭐ **ОСНОВНОЙ ДОКУМЕНТ**

Подробное описание реальной активной архитектуры наблюдаемости.

## Архитектура

Система построена на принципах **активного структурированного логирования** - компоненты интегрированы в runtime цикл и активно логируют ключевые стадии обработки для анализа и отладки.

### Основные принципы

- **Активная интеграция**: StructuredLogger интегрирован в runtime цикл
- **Структурированное логирование**: JSONL формат для машинной обработки
- **Трассировка цепочек**: Полная видимость от события до действия
- **Корреляционные ID**: Связывание событий в причинно-следственные цепочки
- **Потокобезопасность**: Безопасная работа в многопоточной среде

## Компоненты

### [StructuredLogger](structured_logger.md)
Структурированное логирование стадий жизненного цикла (event → meaning → decision → action → feedback).

### [Semantic Monitor](../../components/semantic_monitor.md)
Система непрерывного мониторинга аномалий в поведенческих паттернах с использованием глубокого семантического анализа.

### [Reporting System](reporting.md)
Система генерации HTML отчетов с визуализациями и аналитикой трендов.

## Возможности

- **Структурированное логирование**: JSONL формат для машинной обработки
- **Трассировка цепочек**: Полная видимость от события до действия
- **Семантический мониторинг**: Автоматическое обнаружение аномалий в поведении
- **Метрики производительности**: Автоматический сбор показателей работы
- **Корреляционные ID**: Связывание событий в причинно-следственные цепочки
- **Потокобезопасность**: Безопасная работа в многопоточной среде
- **Активная интеграция**: Встроено в runtime цикл для полной наблюдаемости

## Быстрый старт

### Включение логирования

Система логирования автоматически включается при запуске Life:

```bash
python src/main_server_api.py --tick-interval 1.0 --snapshot-period 10
```

### Просмотр логов

```bash
# Просмотр логов в реальном времени
tail -f data/structured_log.jsonl

# Просмотр событий определенного типа
cat data/structured_log.jsonl | jq 'select(.stage == "event" and .data.type == "shock")'
```

### Анализ производительности

```bash
# Средняя длительность тика
cat data/structured_log.jsonl | jq -r 'select(.stage == "tick_end") | .data.tick_duration_ms' | awk '{sum+=$1; count++} END {print "Среднее:", sum/count, "мс"}'

# Распределение паттернов решений
cat data/structured_log.jsonl | jq -r 'select(.stage == "decision") | .data.pattern' | sort | uniq -c
```

## Архитектура

```
Runtime Loop
    ↓
StructuredLogger (активно интегрирован)
    ↓
JSONL логи → data/structured_log.jsonl
    ↓
Анализ → jq, Python скрипты, дашборды
```

## Использование

### Для разработчиков
- Отладка поведения системы
- Анализ причинно-следственных связей
- Профилирование производительности

### Для исследования
- Изучение паттернов адаптации
- Анализ эффективности решений
- Мониторинг деградации системы

### Для мониторинга
- Оперативное обнаружение проблем
- Автоматизированные алерты
- Построение метрик и дашбордов

## Файлы логов

- **`data/structured_log.jsonl`**: Основной файл структурированных логов
- **`data/tick_log.jsonl`**: Устаревший формат (сохраняется для совместимости)

## Инструменты

### jq
```bash
# Фильтрация по correlation_id
cat data/structured_log.jsonl | jq 'select(.correlation_id == "chain_001")'

# Извлечение метрик
cat data/structured_log.jsonl | jq -r 'select(.stage == "tick_end") | .data.tick_duration_ms'
```

### Python анализ
```python
import json
from collections import Counter

# Подсчет стадий
stages = Counter()
with open('data/structured_log.jsonl', 'r') as f:
    for line in f:
        entry = json.loads(line)
        stages[entry['stage']] += 1

print("Распределение стадий:", dict(stages))
```

## Производительность

- **Накладные расходы**: ~14.9 мс среднее на тик (медиана 9.76 мс)
- **Условное логирование**: Возможность отключения для production (рекомендуется для высоконагруженных сценариев)
- **Потокобезопасность**: Полностью протестирована в многопоточной среде
- **Масштабируемость**: Минимальное влияние на общую производительность системы

## Планы улучшений

### Высокий приоритет
- **Тайминги стадий:** Детальное профилирование каждой стадии обработки
- **Статистика паттернов:** Анализ эффективности различных паттернов решений
- **Стандартизация данных:** Унификация структур data полей

### Средний приоритет
- **Условное логирование:** Многоуровневая система логирования
- **Контекстная информация:** Добавление метаданных о сессии и окружении
- **Автоматические метрики:** Расчет статистики по цепочкам обработки

### Низкий приоритет
- **Буферизация логов:** In-memory буфер для снижения I/O
- **Визуализация цепочек:** Веб-интерфейс для анализа
- **Детекция аномалий:** ML-based выявление проблем

## См. также

- [Runtime Loop](../components/runtime-loop.md) - интеграция StructuredLogger
- [Архитектурные решения](../../adr/) - принципы наблюдаемости
- [Тестирование](../testing/) - тесты системы логирования
