# Система цепочек событий (Chain System)

## Обзор

Система цепочек событий представляет собой механизм для создания естественных последовательностей событий, имитирующих когнитивные и эмоциональные паттерны поведения. Система использует correlation_id для группировки связанных событий и EventDependencyManager для управления вероятностями переходов между состояниями.

## Correlation ID (Идентификаторы цепочек)

### Формат correlation_id

Correlation ID имеет формат `chain_N`, где N - порядковый номер цепочки:

- `chain_1` - первая цепочка событий
- `chain_2` - вторая цепочка событий
- `chain_3` - третья цепочка событий

### Семантика correlation_id

Каждая цепочка представляет собой:
1. **Логическую последовательность** - события в одной цепочке связаны причинно-следственными отношениями
2. **Временную близость** - события в цепочке происходят относительно близко по времени
3. **Тематическую связность** - события относятся к одной когнитивной или эмоциональной теме

## Новые типы событий

Система включает расширенный набор типов событий для моделирования сложных когнитивных и социальных паттернов:

### Социальные события

#### connection (Связь)
- **Диапазон интенсивности:** [0.0, 0.8]
- **Базовая вероятность:** 2.8% (0.028)
- **Семантика:** Ощущение связи с другими существами или миром
- **Роль в цепочках:** Завершающее положительное событие после преодоления изоляции

#### isolation (Изоляция)
- **Диапазон интенсивности:** [-0.7, 0.0]
- **Базовая вероятность:** 2.5% (0.025)
- **Семантика:** Ощущение одиночества, оторванности от других
- **Роль в цепочках:** Начальное негативное событие, часто приводящее к поиску связи

### Когнитивные события

#### insight (Озарение)
- **Диапазон интенсивности:** [0.0, 0.6]
- **Базовая вероятность:** 2.2% (0.022)
- **Семантика:** Момент внезапного понимания, прорыва в осознании
- **Роль в цепочках:** Положительный результат когнитивного поиска

#### confusion (Путаница)
- **Диапазон интенсивности:** [-0.5, 0.0]
- **Базовая вероятность:** 2.0% (0.020)
- **Семантика:** Состояние замешательства, непонимания ситуации
- **Роль в цепочках:** Начальное состояние, требующее разрешения

#### curiosity (Любопытство)
- **Диапазон интенсивности:** [-0.3, 0.4]
- **Базовая вероятность:** 1.8% (0.018)
- **Семантика:** Интерес, желание узнать или понять больше
- **Роль в цепочках:** Переходное состояние между confusion и insight

### Экзистенциальные события

#### meaning_found (Смысл найден)
- **Диапазон интенсивности:** [0.0, 0.9]
- **Базовая вероятность:** 1.5% (0.015)
- **Семантика:** Ощущение нахождения смысла в существовании
- **Роль в цепочках:** Кульминационное событие экзистенциального поиска

#### void (Пустота)
- **Диапазон интенсивности:** [-0.8, 0.0]
- **Базовая вероятность:** 1.2% (0.012)
- **Семантика:** Ощущение отсутствия содержания, бессмысленности
- **Роль в цепочках:** Критическое состояние, требующее разрешения

#### acceptance (Принятие)
- **Диапазон интенсивности:** [0.0, 0.5]
- **Базовая вероятность:** 1.0% (0.010)
- **Семантика:** Принятие текущего состояния, смирение
- **Роль в цепочках:** Завершающее событие после экзистенциального кризиса

## Матрица зависимостей

EventDependencyManager использует следующие паттерны зависимостей:

### Основные паттерны цепочек

#### Confusion → Insight (Путаница → Озарение)
```
confusion (2.5x) → insight
confusion (1.8x) → curiosity
```
*Вероятность цепочки:* confusion → curiosity → insight

#### Isolation → Connection (Изоляция → Связь)
```
isolation (2.8x) → connection
isolation (1.4x) → void
```
*Вероятность цепочки:* isolation → void → meaning_found → connection

#### Void → Meaning (Пустота → Смысл)
```
void (2.0x) → meaning_found
void (1.8x) → acceptance
```
*Вероятность цепочки:* void → confusion → curiosity → meaning_found

### Статистика вероятностей

Общая вероятность генерации новых типов событий: **16.0%** от общего потока (против заявленных 14.3%).

Распределение по категориям:
- Социальные: 5.3% (connection + isolation)
- Когнитивные: 6.0% (insight + confusion + curiosity)
- Экзистенциальные: 4.7% (meaning_found + void + acceptance)

## Примеры цепочек

### Цепочка 1: Когнитивный прорыв
```
timestamp: 1769038646.456165
correlation_id: "chain_1"
sequence: confusion → curiosity → insight
result: положительное разрешение
```

### Цепочка 2: Экзистенциальный кризис
```
timestamp: 1769038646.4583917
correlation_id: "chain_2"
sequence: void → confusion → meaning_found
result: экзистенциальное разрешение
```

### Цепочка 3: Социальный паттерн
```
correlation_id: "chain_3"
sequence: isolation → connection
result: восстановление социальной связи
```

## Интеграция с EventDependencyManager

### Механизм работы

1. **Запись событий** - каждое событие записывается с correlation_id
2. **Анализ истории** - EventDependencyManager анализирует последние 5 событий в цепочке
3. **Расчет модификаторов** - применяются зависимости на основе типа предыдущего события
4. **Корректировка вероятностей** - модификаторы влияют на генерацию следующих событий

### Пример расчета

Для события `confusion` в цепочке:
```python
# Модификаторы для следующих событий
modifiers = {
    "insight": 2.5,      # +150% вероятность озарения
    "curiosity": 1.8,    # +80% вероятность любопытства
    "confusion": 0.3,    # -70% вероятность повторной путаницы
}
```

## Архитектурные принципы

### Затухание влияния
- Влияние событий уменьшается со временем (decay_factor = 0.9)
- Более недавние события имеют больший вес
- Максимальный анализ: последние 5 событий

### Ограничения модификаторов
- Минимальный модификатор: 0.1 (максимальное подавление)
- Максимальный модификатор: 3.0 (максимальное усиление)
- Накопительный эффект: модификаторы перемножаются

### Нормализация
- После применения модификаторов веса нормализуются
- Сумма весов остается постоянной
- Сохраняется баланс вероятностей

## Мониторинг и статистика

EventDependencyManager предоставляет статистику:
- `chains_created` - количество созданных цепочек
- `patterns_detected` - обнаруженных паттернов
- `total_modifications` - примененных модификаторов

## Будущие улучшения

1. **Динамические цепочки** - адаптация паттернов на основе обучения
2. **Многоуровневые зависимости** - связи между разными типами цепочек
3. **Контекстные модификаторы** - учет состояния системы Life
4. **Визуализация цепочек** - инструменты для анализа паттернов