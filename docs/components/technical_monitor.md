# Technical Behavior Monitor

## Обзор

Technical Behavior Monitor - это инструмент технического мониторинга поведения системы Life. Он предоставляет объективные метрики производительности, стабильности, адаптивности и целостности системы без философских интерпретаций.

## Архитектура

Монитор состоит из следующих компонентов:

- **TechnicalBehaviorMonitor**: Основной класс для сбора и анализа метрик
- **TechnicalSnapshot**: Структура данных для снимка состояния системы
- **TechnicalReport**: Структура данных для отчета анализа
- **TechnicalMonitorCLI**: Командная строка для работы с монитором

## Автоматический сбор метрик

Система автоматически собирает метрики каждые 100 тиков (настраивается константой `METRICS_COLLECTION_INTERVAL`) и сохраняет отчеты в директорию `metrics/` в формате JSON.

### Интеграция в runtime

Монитор интегрирован в основной цикл системы (`src/runtime/loop.py`) и собирает метрики без остановки выполнения:

```python
# Технический мониторинг: сбор метрик через регулярные интервалы
ticks_since_last_metrics_collection += 1
if ticks_since_last_metrics_collection >= METRICS_COLLECTION_INTERVAL:
    # Захват и анализ метрик
    snapshot = technical_monitor.capture_system_snapshot(...)
    report = technical_monitor.analyze_snapshot(snapshot)
    technical_monitor.save_report(report, filepath)
```

## Метрики мониторинга

### Производительность (Performance)

- **memory_efficiency**: Эффективность использования памяти (0.0-1.0)
- **learning_progress**: Прогресс в обучении (0.0-1.0)
- **decision_speed**: Скорость принятия решений (секунды)
- **decision_accuracy**: Точность решений (0.0-1.0)
- **overall_performance**: Общая оценка производительности (0.0-1.0)

### Стабильность (Stability)

- **state_consistency**: Согласованность внутреннего состояния (0.0-1.0)
- **behavior_predictability**: Предсказуемость поведения (0.0-1.0)
- **parameter_stability**: Стабильность параметров системы (0.0-1.0)
- **overall_stability**: Общая оценка стабильности (0.0-1.0)

### Адаптивность (Adaptability)

- **learning_rate**: Скорость обучения (0.0-1.0)
- **adaptation_rate**: Скорость адаптации (0.0-1.0)
- **change_responsiveness**: Отклик на изменения (0.0-1.0)
- **overall_adaptability**: Общая оценка адаптивности (0.0-1.0)

### Целостность (Integrity)

- **data_consistency**: Согласованность данных (0.0-1.0)
- **structural_integrity**: Структурная целостность (0.0-1.0)
- **logical_coherence**: Логическая согласованность (0.0-1.0)
- **overall_integrity**: Общая оценка целостности (0.0-1.0)

### Общая оценка

- **overall_score**: Общий балл системы (0.0-1.0)
- **status**: Статус системы (excellent/good/adequate/concerning/critical)

## Использование CLI

### Анализ файла с данными

```bash
python technical_monitor_cli.py analyze --input snapshot.json --output report.json
```

### Анализ трендов

```bash
python technical_monitor_cli.py trends --input-dir ./metrics --hours 24 --output trends.json
```

### Форматы вывода

CLI поддерживает два формата вывода:

- **text**: Человеко-читаемый текстовый формат
- **json**: Структурированный JSON для программной обработки

## Программное API

### Создание монитора

```python
from src.technical_monitor import TechnicalBehaviorMonitor

monitor = TechnicalBehaviorMonitor()
```

### Захват снимка

```python
snapshot = monitor.capture_system_snapshot(
    self_state=self_state,
    memory=memory,
    learning_engine=learning_engine,
    adaptation_manager=adaptation_manager,
    decision_engine=decision_engine
)
```

### Анализ снимка

```python
report = monitor.analyze_snapshot(snapshot)
```

### Сохранение и загрузка отчетов

```python
# Сохранение
monitor.save_report(report, "report.json")

# Загрузка
loaded_report = monitor.load_report("report.json")
```

### Анализ трендов

```python
trends = monitor.get_trends(hours=24)
# Возвращает словарь с направлениями и силой трендов
```

## Обработка ошибок

Монитор включает всестороннюю обработку ошибок:

- **Валидация типов данных**: Все входные данные проверяются на корректность типов
- **Границы значений**: Метрики автоматически приводятся к допустимым диапазонам
- **Graceful degradation**: При ошибках в отдельных компонентах анализ продолжается
- **Подробное логирование**: Все ошибки логируются для диагностики

## Примеры отчетов

### JSON отчет

```json
{
  "performance": {
    "memory_efficiency": 0.85,
    "learning_progress": 0.72,
    "decision_speed": 0.012,
    "decision_accuracy": 0.89,
    "overall_performance": 0.82
  },
  "stability": {
    "state_consistency": 0.91,
    "behavior_predictability": 0.78,
    "parameter_stability": 0.88,
    "overall_stability": 0.86
  },
  "adaptability": {
    "learning_rate": 0.65,
    "adaptation_rate": 0.73,
    "change_responsiveness": 0.58,
    "overall_adaptability": 0.65
  },
  "integrity": {
    "data_consistency": 0.95,
    "structural_integrity": 0.92,
    "logical_coherence": 0.89,
    "overall_integrity": 0.92
  },
  "overall_assessment": {
    "overall_score": 0.81,
    "status": "good"
  }
}
```

### Текстовый отчет

```
=== ТЕХНИЧЕСКИЙ ОТЧЕТ СИСТЕМЫ LIFE ===
Время: 1704327600.123

ПРОИЗВОДИТЕЛЬНОСТЬ:
  Эффективность памяти: 0.85
  Прогресс обучения: 0.72
  Скорость решений: 0.0120
  Точность решений: 0.89
  Общая производительность: 0.82

СТАБИЛЬНОСТЬ:
  Согласованность состояния: 0.91
  Предсказуемость поведения: 0.78
  Стабильность параметров: 0.88
  Общая стабильность: 0.86

АДАПТИВНОСТЬ:
  Скорость обучения: 0.65
  Скорость адаптации: 0.73
  Отклик на изменения: 0.58
  Общая адаптивность: 0.65

ЦЕЛОСТНОСТЬ:
  Согласованность данных: 0.95
  Структурная целостность: 0.92
  Логическая согласованность: 0.89
  Общая целостность: 0.92

ОБЩАЯ ОЦЕНКА:
  Общий балл: 0.81
  Статус: good
```

## Интеграционные тесты

Для проверки корректности работы монитора используются интеграционные тесты:

```bash
python -m pytest test_technical_monitor_integration.py -v
```

Тесты проверяют:
- Работу с реальными компонентами системы Life
- Корректность валидации данных
- Обработку ошибок
- Сохранение и загрузку отчетов
- Анализ трендов

## Производительность

Монитор оптимизирован для минимального влияния на производительность системы:

- **Частота сбора**: Каждые 100 тиков (регулируется `METRICS_COLLECTION_INTERVAL`)
- **Асинхронная обработка**: Метрики собираются в фоне основного цикла
- **Кэширование**: Повторные вычисления минимизированы
- **Оптимизированные структуры**: Используются эффективные структуры данных

## Безопасность и надежность

- **Изоляция**: Монитор не влияет на поведение системы Life
- **Валидация**: Все входные данные тщательно проверяются
- **Обработка исключений**: Система продолжает работу при ошибках в мониторинге
- **Атомарность**: Операции сбора метрик атомарны и не блокируют основной цикл

## Мониторинг и алертинг

Монитор поддерживает базовый мониторинг состояния:

- **Тренды**: Анализ изменений метрик со временем
- **Статусы**: Классификация состояния системы (excellent/good/adequate/concerning/critical)
- **История**: Сохранение предыдущих отчетов для анализа динамики

## Расширение и настройка

Монитор спроектирован для легкого расширения:

- **Плагины**: Новые метрики могут добавляться через интерфейсы
- **Конфигурация**: Параметры сбора метрик настраиваются через константы
- **Форматы**: Легко добавить новые форматы вывода
- **Интеграции**: Поддержка различных систем хранения и визуализации