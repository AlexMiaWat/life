# 02_RUNTIME_LOOP.md — Главный цикл жизни

## Назначение
Runtime Loop — это сердце системы **Life**. Это бесконечный цикл, который обеспечивает непрерывное течение времени и оркестрирует все процессы жизнедеятельности.

Если Loop остановился — только слабость и бессилие.

## Текущий статус
✅ **Реализован** (v1.0)
*   Файл: [`src/runtime/loop.py`](../../src/runtime/loop.py)
*   Поддерживает реальное время (Wall Clock).
*   Интегрирован с Environment, Self-State, Meaning Engine, Memory, Intelligence, Planning.
*   Полная обработка событий через Meaning Engine с сохранением в память.

## Алгоритм такта (Tick)

Каждый такт (Tick) выполняется последовательно:

1.  **Time Update:** Обновление возраста (`age`) и счетчика тактов (`ticks`).
2.  **Perception:** Получение событий из очереди `EventQueue`.
3.  **Interpretation:** Интерпретация событий через Meaning Engine и обновление `Self-State`.
4.  **Memory:** Сохранение значимых событий в эпизодическую память.
5.  **Planning:** Фиксация потенциальных последовательностей событий.
6.  **Intelligence:** Минимальная обработка информации из нейтральных источников.
7.  **Metabolism:** Расчет "физиологических" изменений (усталость, потребление энергии, слабость).
8.  **Monitoring:** Отправка состояния в Monitor.
9.  **Snapshot:** Периодическое сохранение состояния на диск.
10. **Sleep:** Ожидание следующего такта для поддержания стабильного `tick_interval`.

## Ключевые параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `tick_interval` | 1.0 сек | Длительность одного такта. |
| `snapshot_period` | 10 тактов | Как часто сохранять полное состояние на диск. |

## Обработка сбоев

*   Любое исключение внутри цикла логируется, но не останавливает жизнь (если возможно).
*   Исключения наносят урон `integrity`.
*   Если жизненные показатели (`energy`, `integrity`, `stability`) падают до 0, цикл прерывается (`active = False`).

## Пример использования

```python
from runtime.loop import run_loop
from state.self_state import create_initial_state
from monitor.console import console_monitor

# Инициализация
state = create_initial_state()

# Запуск (блокирует поток)
run_loop(
    self_state=state,
    monitor=console_monitor,
    tick_interval=0.5
)
```
